id {
  value: "opioidcds-common"
}
text {
  status {
    value: GENERATED
  }
  div {
    value: "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p><b>Generated Narrative with Details</b></p><p><b>id</b>: opioidcds-common</p><p><b>identifier</b>: OpioidCDS_Common (OFFICIAL)</p><p><b>version</b>: 0.1.0</p><p><b>title</b>: Opioid CDS Common Logic</p><p><b>status</b>: active</p><p><b>experimental</b>: false</p><p><b>type</b>: Logic Library <span>(Details : {http://terminology.hl7.org/CodeSystem/library-type code \'logic-library\' = \'Logic Library\', given as \'Logic Library\'})</span></p><p><b>date</b>: 25/03/2018 1:49:09 PM</p><p><b>publisher</b>: Centers for Disease Control and Prevention (CDC)</p><p><b>description</b>: Common Opioid Decision Support Logic for use in implementing CDC Opioid Prescribing Guidelines.</p><p><b>useContext</b>: , </p><p><b>jurisdiction</b>: United States of America <span>(Details : {urn:iso:std:iso:3166 code \'US\' = \'United States of America\', given as \'United States of America\'})</span></p><p><b>purpose</b>: This library contains common logic across recommendations including MME calculations, conversions, and looking up codes in valuesets.</p><p><b>usage</b>: This library is used for decision support for opioid guideline recommendations when applying PlanDefinitions.</p><p><b>copyright</b>: \302\251 CDC 2016+.</p><p><b>topic</b>: Opioid Prescribing <span>(Details )</span></p><p><b>author</b>: , , , </p><p><b>relatedArtifact</b>: , , </p><p><b>content</b>: </p></div>"
  }
}
identifier {
  use {
    value: OFFICIAL
  }
  value {
    value: "OpioidCDS_Common"
  }
}
version {
  value: "0.1.0"
}
title {
  value: "Opioid CDS Common Logic"
}
status {
  value: ACTIVE
}
experimental {
}
type {
  coding {
    system {
      value: "http://terminology.hl7.org/CodeSystem/library-type"
    }
    code {
      value: "logic-library"
    }
    display {
      value: "Logic Library"
    }
  }
}
date {
  value_us: 1522007349000000
  timezone: "-06:00"
  precision: SECOND
}
publisher {
  value: "Centers for Disease Control and Prevention (CDC)"
}
description {
  value: "Common Opioid Decision Support Logic for use in implementing CDC Opioid Prescribing Guidelines."
}
use_context {
  code {
    system {
      value: "http://terminology.hl7.org/CodeSystem/usage-context-type"
    }
    code {
      value: "focus"
    }
    display {
      value: "Clinical Focus"
    }
  }
  value {
    codeable_concept {
      coding {
        system {
          value: "http://snomed.info/sct"
        }
        code {
          value: "182888003"
        }
        display {
          value: "Medication requested (situation)"
        }
      }
    }
  }
}
use_context {
  code {
    system {
      value: "http://terminology.hl7.org/CodeSystem/usage-context-type"
    }
    code {
      value: "focus"
    }
    display {
      value: "Clinical Focus"
    }
  }
  value {
    codeable_concept {
      coding {
        system {
          value: "http://snomed.info/sct"
        }
        code {
          value: "82423001"
        }
        display {
          value: "Chronic pain (finding)"
        }
      }
    }
  }
}
jurisdiction {
  coding {
    system {
      value: "urn:iso:std:iso:3166"
    }
    code {
      value: "US"
    }
    display {
      value: "United States of America"
    }
  }
}
purpose {
  value: "This library contains common logic across recommendations including MME calculations, conversions, and looking up codes in valuesets."
}
usage {
  value: "This library is used for decision support for opioid guideline recommendations when applying PlanDefinitions."
}
copyright {
  value: "\302\251 CDC 2016+."
}
topic {
  text {
    value: "Opioid Prescribing"
  }
}
author {
  name {
    value: "Kensaku Kawamoto, MD, PhD, MHS"
  }
}
author {
  name {
    value: "Bryn Rhodes"
  }
}
author {
  name {
    value: "Floyd Eisenberg, MD, MPH"
  }
}
author {
  name {
    value: "Robert McClure, MD, MPH"
  }
}
related_artifact {
  type {
    value: DOCUMENTATION
  }
  display {
    value: "CDC guideline for prescribing opioids for chronic pain"
  }
  url {
    value: "https://guidelines.gov/summaries/summary/50153/cdc-guideline-for-prescribing-opioids-for-chronic-pain---united-states-2016#420"
  }
}
related_artifact {
  type {
    value: DEPENDS_ON
  }
  resource {
    value: "Library/omtk-logic"
  }
}
related_artifact {
  type {
    value: DOCUMENTATION
  }
  display {
    value: "MME Conversion Tables"
  }
  url {
    value: "https://www.cdc.gov/drugoverdose/pdf/calculating_total_daily_dose-a.pdf"
  }
}
content {
  content_type {
    value: "application/elm+xml"
  }
  data {
    value: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<library xmlns=\"urn:hl7-org:elm:r1\" xmlns:t=\"urn:hl7-org:elm-types:r1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:fhir=\"http://hl7.org/fhir\" xmlns:qdm43=\"urn:healthit-gov:qdm:v4_3\" xmlns:qdm53=\"urn:healthit-gov:qdm:v5_3\" xmlns:a=\"urn:hl7-org:cql-annotations:r1\">\n   <identifier id=\"OpioidCDS_STU4_Common\" version=\"0.1.0\"/>\n   <schemaIdentifier id=\"urn:hl7-org:elm\" version=\"r1\"/>\n   <usings>\n      <def localIdentifier=\"System\" uri=\"urn:hl7-org:elm-types:r1\"/>\n      <def localIdentifier=\"FHIR\" uri=\"http://hl7.org/fhir\" version=\"3.2.0\"/>\n   </usings>\n   <includes>\n      <def localIdentifier=\"OMTKLogic\" path=\"OMTKLogic\" version=\"0.1.0\"/>\n   </includes>\n   <valueSets>\n      <def name=\"Benzodiazepines\" id=\"benzodiazepines\" accessLevel=\"Public\"/>\n      <def name=\"Naloxone\" id=\"naloxone\" accessLevel=\"Public\"/>\n      <def name=\"Ambulatory Abuse Potential Opioids\" id=\"opioids-abused-in-ambulatory-care\" accessLevel=\"Public\"/>\n      <def name=\"End Of Life Opioids\" id=\"opioids-indicating-end-of-life\" accessLevel=\"Public\"/>\n      <def name=\"Long Acting Opioids\" id=\"long-acting-opioids\" accessLevel=\"Public\"/>\n      <def name=\"Illicit Drug Screening\" id=\"illicit-drug-urine-screening\" accessLevel=\"Public\"/>\n      <def name=\"Opioid Drug Screening\" id=\"opioid-urine-screening\" accessLevel=\"Public\"/>\n      <def name=\"Opioids\" id=\"opioids\" accessLevel=\"Public\"/>\n      <def name=\"Codeine Cough Meds\" id=\"opioids-codeine-cough-meds\" accessLevel=\"Public\"/>\n      <def name=\"Short Acting Opioids\" id=\"short-acting-opioids\" accessLevel=\"Public\"/>\n   </valueSets>\n   <statements>\n      <def name=\"IsForChronicPain\" context=\"Patient\" accessLevel=\"Public\">\n         <expression valueType=\"t:Boolean\" value=\"true\" xsi:type=\"Literal\"/>\n      </def>\n      <def name=\"HasMetastaticCancer\" context=\"Patient\" accessLevel=\"Public\">\n         <expression valueType=\"t:Boolean\" value=\"false\" xsi:type=\"Literal\"/>\n      </def>\n      <def name=\"ToCode\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression classType=\"t:Code\" xsi:type=\"Instance\">\n            <element name=\"code\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"code\" xsi:type=\"Property\">\n                     <source name=\"coding\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n            <element name=\"system\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"system\" xsi:type=\"Property\">\n                     <source name=\"coding\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n            <element name=\"version\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"version\" xsi:type=\"Property\">\n                     <source name=\"coding\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n            <element name=\"display\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"display\" xsi:type=\"Property\">\n                     <source name=\"coding\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n         </expression>\n         <operand name=\"coding\">\n            <operandTypeSpecifier name=\"fhir:Coding\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"ToQuantity\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression classType=\"t:Quantity\" xsi:type=\"Instance\">\n            <element name=\"value\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"value\" xsi:type=\"Property\">\n                     <source name=\"quantity\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n            <element name=\"unit\">\n               <value path=\"value\" xsi:type=\"Property\">\n                  <source path=\"unit\" xsi:type=\"Property\">\n                     <source name=\"quantity\" xsi:type=\"OperandRef\"/>\n                  </source>\n               </value>\n            </element>\n         </expression>\n         <operand name=\"quantity\">\n            <operandTypeSpecifier name=\"fhir:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"Prescriptions\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Query\">\n            <source alias=\"O\">\n               <expression name=\"Orders\" xsi:type=\"OperandRef\"/>\n            </source>\n            <let identifier=\"rxNormCode\">\n               <expression name=\"ToCode\" xsi:type=\"FunctionRef\">\n                  <operand xsi:type=\"Indexer\">\n                     <operand path=\"coding\" xsi:type=\"Property\">\n                        <source path=\"medication\" scope=\"O\" xsi:type=\"Property\"/>\n                     </operand>\n                     <operand valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                  </operand>\n               </expression>\n            </let>\n            <let identifier=\"medicationName\">\n               <expression name=\"GetMedicationName\" libraryName=\"OMTKLogic\" xsi:type=\"FunctionRef\">\n                  <operand name=\"rxNormCode\" xsi:type=\"QueryLetRef\"/>\n               </expression>\n            </let>\n            <let identifier=\"dosageInstruction\">\n               <expression xsi:type=\"Indexer\">\n                  <operand path=\"dosageInstruction\" scope=\"O\" xsi:type=\"Property\"/>\n                  <operand valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </expression>\n            </let>\n            <let identifier=\"repeat\">\n               <expression path=\"repeat\" xsi:type=\"Property\">\n                  <source path=\"timing\" xsi:type=\"Property\">\n                     <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                  </source>\n               </expression>\n            </let>\n            <let identifier=\"frequency\">\n               <expression xsi:type=\"Coalesce\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"frequencyMax\" xsi:type=\"Property\">\n                        <source name=\"repeat\" xsi:type=\"QueryLetRef\"/>\n                     </source>\n                  </operand>\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"frequency\" xsi:type=\"Property\">\n                        <source name=\"repeat\" xsi:type=\"QueryLetRef\"/>\n                     </source>\n                  </operand>\n               </expression>\n            </let>\n            <let identifier=\"period\">\n               <expression classType=\"t:Quantity\" xsi:type=\"Instance\">\n                  <element name=\"value\">\n                     <value path=\"value\" xsi:type=\"Property\">\n                        <source path=\"period\" xsi:type=\"Property\">\n                           <source name=\"repeat\" xsi:type=\"QueryLetRef\"/>\n                        </source>\n                     </value>\n                  </element>\n                  <element name=\"unit\">\n                     <value path=\"value\" xsi:type=\"Property\">\n                        <source path=\"periodUnit\" xsi:type=\"Property\">\n                           <source name=\"repeat\" xsi:type=\"QueryLetRef\"/>\n                        </source>\n                     </value>\n                  </element>\n               </expression>\n            </let>\n            <let identifier=\"doseDescription\">\n               <expression xsi:type=\"Coalesce\">\n                  <operand xsi:type=\"ToList\">\n                     <operand xsi:type=\"If\">\n                        <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                           <operand xsi:type=\"Is\">\n                              <operand path=\"dose\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </operand>\n                              <isTypeSpecifier name=\"fhir:Range\" xsi:type=\"NamedTypeSpecifier\"/>\n                           </operand>\n                        </condition>\n                        <then xsi:type=\"Concatenate\">\n                           <operand xsi:type=\"Concatenate\">\n                              <operand xsi:type=\"Concatenate\">\n                                 <operand xsi:type=\"ToString\">\n                                    <operand name=\"ToQuantity\" xsi:type=\"FunctionRef\">\n                                       <operand path=\"low\" xsi:type=\"Property\">\n                                          <source path=\"dose\" xsi:type=\"Property\">\n                                             <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                          </source>\n                                       </operand>\n                                    </operand>\n                                 </operand>\n                                 <operand valueType=\"t:String\" value=\"-\" xsi:type=\"Literal\"/>\n                              </operand>\n                              <operand xsi:type=\"ToString\">\n                                 <operand name=\"ToQuantity\" xsi:type=\"FunctionRef\">\n                                    <operand path=\"high\" xsi:type=\"Property\">\n                                       <source path=\"dose\" xsi:type=\"Property\">\n                                          <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                       </source>\n                                    </operand>\n                                 </operand>\n                              </operand>\n                           </operand>\n                           <operand path=\"value\" xsi:type=\"Property\">\n                              <source path=\"unit\" xsi:type=\"Property\">\n                                 <source path=\"high\" xsi:type=\"Property\">\n                                    <source path=\"dose\" xsi:type=\"Property\">\n                                       <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                    </source>\n                                 </source>\n                              </source>\n                           </operand>\n                        </then>\n                        <else xsi:type=\"ToString\">\n                           <operand name=\"ToQuantity\" xsi:type=\"FunctionRef\">\n                              <operand asType=\"fhir:Quantity\" xsi:type=\"As\">\n                                 <operand path=\"dose\" xsi:type=\"Property\">\n                                    <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                 </operand>\n                              </operand>\n                           </operand>\n                        </else>\n                     </operand>\n                  </operand>\n               </expression>\n            </let>\n            <let identifier=\"frequencyDescription\">\n               <expression xsi:type=\"Concatenate\">\n                  <operand xsi:type=\"ToString\">\n                     <operand path=\"value\" xsi:type=\"Property\">\n                        <source path=\"frequency\" xsi:type=\"Property\">\n                           <source path=\"repeat\" xsi:type=\"Property\">\n                              <source path=\"timing\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </source>\n                           </source>\n                        </source>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"Coalesce\">\n                     <operand xsi:type=\"Concatenate\">\n                        <operand valueType=\"t:String\" value=\"-\" xsi:type=\"Literal\"/>\n                        <operand xsi:type=\"ToString\">\n                           <operand path=\"value\" xsi:type=\"Property\">\n                              <source path=\"frequencyMax\" xsi:type=\"Property\">\n                                 <source path=\"repeat\" xsi:type=\"Property\">\n                                    <source path=\"timing\" xsi:type=\"Property\">\n                                       <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                    </source>\n                                 </source>\n                              </source>\n                           </operand>\n                        </operand>\n                     </operand>\n                     <operand valueType=\"t:String\" value=\"\" xsi:type=\"Literal\"/>\n                  </operand>\n               </expression>\n            </let>\n            <return>\n               <expression xsi:type=\"Tuple\">\n                  <element name=\"rxNormCode\">\n                     <value name=\"rxNormCode\" xsi:type=\"QueryLetRef\"/>\n                  </element>\n                  <element name=\"isDraft\">\n                     <value xsi:type=\"Equal\">\n                        <operand path=\"value\" xsi:type=\"Property\">\n                           <source path=\"status\" scope=\"O\" xsi:type=\"Property\"/>\n                        </operand>\n                        <operand valueType=\"t:String\" value=\"draft\" xsi:type=\"Literal\"/>\n                     </value>\n                  </element>\n                  <element name=\"isPRN\">\n                     <value path=\"value\" xsi:type=\"Property\">\n                        <source path=\"asNeeded\" xsi:type=\"Property\">\n                           <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                        </source>\n                     </value>\n                  </element>\n                  <element name=\"prescription\">\n                     <value xsi:type=\"If\">\n                        <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                           <operand xsi:type=\"Not\">\n                              <operand xsi:type=\"IsNull\">\n                                 <operand path=\"text\" xsi:type=\"Property\">\n                                    <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                 </operand>\n                              </operand>\n                           </operand>\n                        </condition>\n                        <then xsi:type=\"Concatenate\">\n                           <operand xsi:type=\"Concatenate\">\n                              <operand name=\"medicationName\" xsi:type=\"QueryLetRef\"/>\n                              <operand valueType=\"t:String\" value=\" \" xsi:type=\"Literal\"/>\n                           </operand>\n                           <operand path=\"value\" xsi:type=\"Property\">\n                              <source path=\"text\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </source>\n                           </operand>\n                        </then>\n                        <else xsi:type=\"Concatenate\">\n                           <operand xsi:type=\"Concatenate\">\n                              <operand xsi:type=\"Concatenate\">\n                                 <operand xsi:type=\"Concatenate\">\n                                    <operand xsi:type=\"Concatenate\">\n                                       <operand name=\"medicationName\" xsi:type=\"QueryLetRef\"/>\n                                       <operand valueType=\"t:String\" value=\" \" xsi:type=\"Literal\"/>\n                                    </operand>\n                                    <operand name=\"doseDescription\" xsi:type=\"QueryLetRef\"/>\n                                 </operand>\n                                 <operand valueType=\"t:String\" value=\" q\" xsi:type=\"Literal\"/>\n                              </operand>\n                              <operand name=\"frequencyDescription\" xsi:type=\"QueryLetRef\"/>\n                           </operand>\n                           <operand xsi:type=\"If\">\n                              <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                                 <operand path=\"value\" xsi:type=\"Property\">\n                                    <source path=\"asNeeded\" xsi:type=\"Property\">\n                                       <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                                    </source>\n                                 </operand>\n                              </condition>\n                              <then valueType=\"t:String\" value=\" PRN\" xsi:type=\"Literal\"/>\n                              <else valueType=\"t:String\" value=\"\" xsi:type=\"Literal\"/>\n                           </operand>\n                        </else>\n                     </value>\n                  </element>\n                  <element name=\"dose\">\n                     <value xsi:type=\"If\">\n                        <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                           <operand xsi:type=\"Is\">\n                              <operand path=\"dose\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </operand>\n                              <isTypeSpecifier name=\"fhir:Range\" xsi:type=\"NamedTypeSpecifier\"/>\n                           </operand>\n                        </condition>\n                        <then name=\"ToQuantity\" xsi:type=\"FunctionRef\">\n                           <operand path=\"high\" xsi:type=\"Property\">\n                              <source path=\"dose\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </source>\n                           </operand>\n                        </then>\n                        <else name=\"ToQuantity\" xsi:type=\"FunctionRef\">\n                           <operand asType=\"fhir:Quantity\" xsi:type=\"As\">\n                              <operand path=\"dose\" xsi:type=\"Property\">\n                                 <source name=\"dosageInstruction\" xsi:type=\"QueryLetRef\"/>\n                              </operand>\n                           </operand>\n                        </else>\n                     </value>\n                  </element>\n                  <element name=\"dosesPerDay\">\n                     <value xsi:type=\"Coalesce\">\n                        <operand name=\"ToDaily\" libraryName=\"OMTKLogic\" xsi:type=\"FunctionRef\">\n                           <operand name=\"frequency\" xsi:type=\"QueryLetRef\"/>\n                           <operand name=\"period\" xsi:type=\"QueryLetRef\"/>\n                        </operand>\n                        <operand valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n                     </value>\n                  </element>\n               </expression>\n            </return>\n         </expression>\n         <operand name=\"Orders\">\n            <operandTypeSpecifier xsi:type=\"ListTypeSpecifier\">\n               <elementType name=\"fhir:MedicationRequest\" xsi:type=\"NamedTypeSpecifier\"/>\n            </operandTypeSpecifier>\n         </operand>\n      </def>\n      <def name=\"MME\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Query\">\n            <source alias=\"P\">\n               <expression name=\"Prescriptions\" xsi:type=\"FunctionRef\">\n                  <operand name=\"prescriptions\" xsi:type=\"OperandRef\"/>\n               </expression>\n            </source>\n            <let identifier=\"mme\">\n               <expression xsi:type=\"SingletonFrom\">\n                  <operand name=\"CalculateMMEs\" libraryName=\"OMTKLogic\" xsi:type=\"FunctionRef\">\n                     <operand xsi:type=\"List\">\n                        <element xsi:type=\"Tuple\">\n                           <element name=\"rxNormCode\">\n                              <value path=\"rxNormCode\" scope=\"P\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"doseQuantity\">\n                              <value path=\"dose\" scope=\"P\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"dosesPerDay\">\n                              <value path=\"dosesPerDay\" scope=\"P\" xsi:type=\"Property\"/>\n                           </element>\n                        </element>\n                     </operand>\n                  </operand>\n               </expression>\n            </let>\n            <return>\n               <expression xsi:type=\"Tuple\">\n                  <element name=\"rxNormCode\">\n                     <value path=\"rxNormCode\" scope=\"P\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"isDraft\">\n                     <value path=\"isDraft\" scope=\"P\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"isPRN\">\n                     <value path=\"isPRN\" scope=\"P\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"prescription\">\n                     <value path=\"prescription\" scope=\"P\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"dailyDose\">\n                     <value path=\"dailyDoseDescription\" xsi:type=\"Property\">\n                        <source name=\"mme\" xsi:type=\"QueryLetRef\"/>\n                     </value>\n                  </element>\n                  <element name=\"conversionFactor\">\n                     <value path=\"conversionFactor\" xsi:type=\"Property\">\n                        <source name=\"mme\" xsi:type=\"QueryLetRef\"/>\n                     </value>\n                  </element>\n                  <element name=\"mme\">\n                     <value path=\"mme\" xsi:type=\"Property\">\n                        <source name=\"mme\" xsi:type=\"QueryLetRef\"/>\n                     </value>\n                  </element>\n               </expression>\n            </return>\n         </expression>\n         <operand name=\"prescriptions\">\n            <operandTypeSpecifier xsi:type=\"ListTypeSpecifier\">\n               <elementType name=\"fhir:MedicationRequest\" xsi:type=\"NamedTypeSpecifier\"/>\n            </operandTypeSpecifier>\n         </operand>\n      </def>\n      <def name=\"TotalMME\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression classType=\"t:Quantity\" xsi:type=\"Instance\">\n            <element name=\"value\">\n               <value xsi:type=\"Sum\">\n                  <source xsi:type=\"Query\">\n                     <source alias=\"M\">\n                        <expression name=\"MME\" xsi:type=\"FunctionRef\">\n                           <operand name=\"prescriptions\" xsi:type=\"OperandRef\"/>\n                        </expression>\n                     </source>\n                     <return>\n                        <expression path=\"value\" xsi:type=\"Property\">\n                           <source path=\"mme\" scope=\"M\" xsi:type=\"Property\"/>\n                        </expression>\n                     </return>\n                  </source>\n               </value>\n            </element>\n            <element name=\"unit\">\n               <value valueType=\"t:String\" value=\"mg/d\" xsi:type=\"Literal\"/>\n            </element>\n         </expression>\n         <operand name=\"prescriptions\">\n            <operandTypeSpecifier xsi:type=\"ListTypeSpecifier\">\n               <elementType name=\"fhir:MedicationRequest\" xsi:type=\"NamedTypeSpecifier\"/>\n            </operandTypeSpecifier>\n         </operand>\n      </def>\n      <def name=\"GetPeriodDays\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Case\">\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand name=\"value\" xsi:type=\"OperandRef\"/>\n                  <operand valueType=\"t:String\" value=\"year\" xsi:type=\"Literal\"/>\n               </when>\n               <then valueType=\"t:Decimal\" value=\"365.0\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand name=\"value\" xsi:type=\"OperandRef\"/>\n                  <operand valueType=\"t:String\" value=\"month\" xsi:type=\"Literal\"/>\n               </when>\n               <then valueType=\"t:Decimal\" value=\"30.0\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand name=\"value\" xsi:type=\"OperandRef\"/>\n                  <operand valueType=\"t:String\" value=\"hour\" xsi:type=\"Literal\"/>\n               </when>\n               <then xsi:type=\"Divide\">\n                  <operand valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n                  <operand valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand name=\"value\" xsi:type=\"OperandRef\"/>\n                  <operand valueType=\"t:String\" value=\"minute\" xsi:type=\"Literal\"/>\n               </when>\n               <then xsi:type=\"Multiply\">\n                  <operand xsi:type=\"Divide\">\n                     <operand valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n                     <operand valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                  </operand>\n                  <operand valueType=\"t:Decimal\" value=\"60.0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <else valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n         </expression>\n         <operand name=\"value\">\n            <operandTypeSpecifier name=\"t:String\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"GetDurationInDays\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Case\">\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"unit\" xsi:type=\"Property\">\n                        <source name=\"value\" xsi:type=\"OperandRef\"/>\n                     </source>\n                  </operand>\n                  <operand valueType=\"t:String\" value=\"year\" xsi:type=\"Literal\"/>\n               </when>\n               <then xsi:type=\"Multiply\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"value\" xsi:type=\"Property\">\n                        <source name=\"value\" xsi:type=\"OperandRef\"/>\n                     </source>\n                  </operand>\n                  <operand valueType=\"t:Decimal\" value=\"365.0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem>\n               <when xsi:type=\"StartsWith\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"unit\" xsi:type=\"Property\">\n                        <source name=\"value\" xsi:type=\"OperandRef\"/>\n                     </source>\n                  </operand>\n                  <operand valueType=\"t:String\" value=\"month\" xsi:type=\"Literal\"/>\n               </when>\n               <then xsi:type=\"Multiply\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"value\" xsi:type=\"Property\">\n                        <source name=\"value\" xsi:type=\"OperandRef\"/>\n                     </source>\n                  </operand>\n                  <operand valueType=\"t:Decimal\" value=\"30.0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <else path=\"value\" xsi:type=\"Property\">\n               <source path=\"value\" xsi:type=\"Property\">\n                  <source name=\"value\" xsi:type=\"OperandRef\"/>\n               </source>\n            </else>\n         </expression>\n         <operand name=\"value\">\n            <operandTypeSpecifier name=\"fhir:Duration\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"ProbableDaysInRange\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Query\">\n            <source alias=\"orders\">\n               <expression name=\"Orders\" xsi:type=\"OperandRef\"/>\n            </source>\n            <let identifier=\"frequency\">\n               <expression path=\"value\" xsi:type=\"Property\">\n                  <source path=\"frequency\" xsi:type=\"Property\">\n                     <source path=\"repeat\" xsi:type=\"Property\">\n                        <source path=\"timing\" xsi:type=\"Property\">\n                           <source xsi:type=\"Indexer\">\n                              <operand path=\"dosageInstruction\" scope=\"orders\" xsi:type=\"Property\"/>\n                              <operand valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                           </source>\n                        </source>\n                     </source>\n                  </source>\n               </expression>\n            </let>\n            <let identifier=\"period\">\n               <expression path=\"value\" xsi:type=\"Property\">\n                  <source path=\"period\" xsi:type=\"Property\">\n                     <source path=\"repeat\" xsi:type=\"Property\">\n                        <source path=\"timing\" xsi:type=\"Property\">\n                           <source xsi:type=\"Indexer\">\n                              <operand path=\"dosageInstruction\" scope=\"orders\" xsi:type=\"Property\"/>\n                              <operand valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                           </source>\n                        </source>\n                     </source>\n                  </source>\n               </expression>\n            </let>\n            <let identifier=\"periodDays\">\n               <expression name=\"GetPeriodDays\" xsi:type=\"FunctionRef\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"periodUnit\" xsi:type=\"Property\">\n                        <source path=\"repeat\" xsi:type=\"Property\">\n                           <source path=\"timing\" xsi:type=\"Property\">\n                              <source xsi:type=\"Indexer\">\n                                 <operand path=\"dosageInstruction\" scope=\"orders\" xsi:type=\"Property\"/>\n                                 <operand valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                              </source>\n                           </source>\n                        </source>\n                     </source>\n                  </operand>\n               </expression>\n            </let>\n            <let identifier=\"dosesPerDay\">\n               <expression xsi:type=\"If\">\n                  <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                     <operand xsi:type=\"GreaterOrEqual\">\n                        <operand xsi:type=\"Divide\">\n                           <operand xsi:type=\"ToDecimal\">\n                              <operand name=\"frequency\" xsi:type=\"QueryLetRef\"/>\n                           </operand>\n                           <operand xsi:type=\"Multiply\">\n                              <operand name=\"period\" xsi:type=\"QueryLetRef\"/>\n                              <operand name=\"periodDays\" xsi:type=\"QueryLetRef\"/>\n                           </operand>\n                        </operand>\n                        <operand valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </condition>\n                  <then valueType=\"t:Decimal\" value=\"1.0\" xsi:type=\"Literal\"/>\n                  <else xsi:type=\"Divide\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand name=\"frequency\" xsi:type=\"QueryLetRef\"/>\n                     </operand>\n                     <operand xsi:type=\"Multiply\">\n                        <operand name=\"period\" xsi:type=\"QueryLetRef\"/>\n                        <operand name=\"periodDays\" xsi:type=\"QueryLetRef\"/>\n                     </operand>\n                  </else>\n               </expression>\n            </let>\n            <let identifier=\"repeat\">\n               <expression path=\"value\" xsi:type=\"Property\">\n                  <source path=\"numberOfRepeatsAllowed\" xsi:type=\"Property\">\n                     <source path=\"dispenseRequest\" scope=\"orders\" xsi:type=\"Property\"/>\n                  </source>\n               </expression>\n            </let>\n            <let identifier=\"supplyDuration\">\n               <expression name=\"GetDurationInDays\" xsi:type=\"FunctionRef\">\n                  <operand path=\"expectedSupplyDuration\" xsi:type=\"Property\">\n                     <source path=\"dispenseRequest\" scope=\"orders\" xsi:type=\"Property\"/>\n                  </operand>\n               </expression>\n            </let>\n            <let identifier=\"validityPeriod\">\n               <expression precision=\"Day\" xsi:type=\"DurationBetween\">\n                  <operand path=\"value\" xsi:type=\"Property\">\n                     <source path=\"start\" xsi:type=\"Property\">\n                        <source path=\"validityPeriod\" xsi:type=\"Property\">\n                           <source path=\"dispenseRequest\" scope=\"orders\" xsi:type=\"Property\"/>\n                        </source>\n                     </source>\n                  </operand>\n                  <operand xsi:type=\"Today\"/>\n               </expression>\n            </let>\n            <let identifier=\"endDifference\">\n               <expression xsi:type=\"If\">\n                  <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                     <operand xsi:type=\"Less\">\n                        <operand path=\"value\" xsi:type=\"Property\">\n                           <source path=\"end\" xsi:type=\"Property\">\n                              <source path=\"validityPeriod\" xsi:type=\"Property\">\n                                 <source path=\"dispenseRequest\" scope=\"orders\" xsi:type=\"Property\"/>\n                              </source>\n                           </source>\n                        </operand>\n                        <operand xsi:type=\"Today\"/>\n                     </operand>\n                  </condition>\n                  <then precision=\"Day\" xsi:type=\"DurationBetween\">\n                     <operand path=\"value\" xsi:type=\"Property\">\n                        <source path=\"end\" xsi:type=\"Property\">\n                           <source path=\"validityPeriod\" xsi:type=\"Property\">\n                              <source path=\"dispenseRequest\" scope=\"orders\" xsi:type=\"Property\"/>\n                           </source>\n                        </source>\n                     </operand>\n                     <operand xsi:type=\"Today\"/>\n                  </then>\n                  <else valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </expression>\n            </let>\n            <return>\n               <expression xsi:type=\"GreaterOrEqual\">\n                  <operand xsi:type=\"Multiply\">\n                     <operand xsi:type=\"Multiply\">\n                        <operand name=\"dosesPerDay\" xsi:type=\"QueryLetRef\"/>\n                        <operand xsi:type=\"Divide\">\n                           <operand xsi:type=\"Multiply\">\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand name=\"repeat\" xsi:type=\"QueryLetRef\"/>\n                              </operand>\n                              <operand name=\"supplyDuration\" xsi:type=\"QueryLetRef\"/>\n                           </operand>\n                           <operand xsi:type=\"ToDecimal\">\n                              <operand name=\"validityPeriod\" xsi:type=\"QueryLetRef\"/>\n                           </operand>\n                        </operand>\n                     </operand>\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand xsi:type=\"Subtract\">\n                           <operand name=\"daysPast\" xsi:type=\"OperandRef\"/>\n                           <operand name=\"endDifference\" xsi:type=\"QueryLetRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand name=\"numDaysInDaysPast\" xsi:type=\"OperandRef\"/>\n                  </operand>\n               </expression>\n            </return>\n         </expression>\n         <operand name=\"Orders\">\n            <operandTypeSpecifier xsi:type=\"ListTypeSpecifier\">\n               <elementType name=\"fhir:MedicationRequest\" xsi:type=\"NamedTypeSpecifier\"/>\n            </operandTypeSpecifier>\n         </operand>\n         <operand name=\"daysPast\">\n            <operandTypeSpecifier name=\"t:Integer\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"numDaysInDaysPast\">\n            <operandTypeSpecifier name=\"t:Integer\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsNaloxone\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Naloxone\"/>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsBenzodiazepine\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Benzodiazepines\"/>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsOpioidWithAmbulatoryAbusePotential\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Ambulatory Abuse Potential Opioids\"/>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsLongActingOpioid\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Long Acting Opioids\"/>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsEndOfLifeOpioid\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"End Of Life Opioids\"/>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsOpioidDrugScreen\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"observationCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Opioid Drug Screening\"/>\n         </expression>\n         <operand name=\"observationCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"IsIllicitDrugScreen\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"InValueSet\">\n            <code name=\"observationCode\" xsi:type=\"OperandRef\"/>\n            <valueset name=\"Illicit Drug Screening\"/>\n         </expression>\n         <operand name=\"observationCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def name=\"GetIngredient\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <expression xsi:type=\"Query\">\n            <source alias=\"$this\">\n               <expression name=\"GetIngredients\" libraryName=\"OMTKLogic\" xsi:type=\"FunctionRef\">\n                  <operand name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n               </expression>\n            </source>\n            <where xsi:type=\"Not\">\n               <operand xsi:type=\"IsNull\">\n                  <operand path=\"ingredientName\" xsi:type=\"Property\">\n                     <source name=\"$this\" xsi:type=\"AliasRef\"/>\n                  </operand>\n               </operand>\n            </where>\n            <return>\n               <expression path=\"ingredientName\" xsi:type=\"Property\">\n                  <source name=\"$this\" xsi:type=\"AliasRef\"/>\n               </expression>\n            </return>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n   </statements>\n</library>\n"
  }
}
