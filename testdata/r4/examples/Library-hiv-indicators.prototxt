id {
  value: "hiv-indicators"
}
text {
  status {
    value: GENERATED
  }
  div {
    value: "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p><b>Generated Narrative with Details</b></p><p><b>id</b>: hiv-indicators</p><p><b>url</b>: <b>http://ohie.org/Library/hiv-indicators</b></p><p><b>identifier</b>: hiv-indicators</p><p><b>version</b>: 0.0.0</p><p><b>title</b>: HIV Indicators</p><p><b>status</b>: draft</p><p><b>experimental</b>: true</p><p><b>type</b>: Logic Library <span>(Details : {http://terminology.hl7.org/CodeSystem/library-type code \'logic-library\' = \'Logic Library\', given as \'Logic Library\'})</span></p><p><b>date</b>: 03/08/2018</p><p><b>description</b>: HIV Indicators Reporting Example</p><p><b>relatedArtifact</b>: </p><p><b>content</b>: </p></div>"
  }
}
url {
  value: "http://ohie.org/Library/hiv-indicators"
}
identifier {
  system {
    value: "http://ohie.org/Library/"
  }
  value {
    value: "hiv-indicators"
  }
}
version {
  value: "0.0.0"
}
title {
  value: "HIV Indicators"
}
status {
  value: DRAFT
}
experimental {
  value: true
}
type {
  coding {
    system {
      value: "http://terminology.hl7.org/CodeSystem/library-type"
    }
    code {
      value: "logic-library"
    }
    display {
      value: "Logic Library"
    }
  }
}
date {
  value_us: 1533218400000000
  timezone: "Australia/Sydney"
  precision: DAY
}
description {
  value: "HIV Indicators Reporting Example"
}
related_artifact {
  type {
    value: DERIVED_FROM
  }
  url {
    value: "http://wiki.ihe.net/index.php/Aggregate_Data_Exchange_-_HIV"
  }
}
content {
  content_type {
    value: "text/cql"
  }
  data {
    value: "library HIV_Indicators version \'0.0.0\'\n\n/*\nThe content in this library is draft content developed as part of a working OpenHIE\nsession on the use of FHIR quality reporting functionality to report public health \nindicators: https://wiki.ihe.net/index.php/Aggregate_Data_Exchange_-_HIV\n*/\n\nusing FHIR version \'3.0.0\'\n\n// SNOMED-CT, International Edition\ncodesystem \"SNOMED-CT\": \'http://snomed.info/sct/900000000000207008\' \n\n// LOINC, 2.63+\ncodesystem \"LOINC\": \'http://loinc.org\'\n\ncodesystem \"ISO-8601-Derived Periods\": \'http://ohie.org/ValueSet/iso-8601-derived-periods\' // { \'P0Y--P1Y\', \'P1Y--P5Y\', ... }\ncodesystem \"PMTCT HIV Status Codes\": \'TBD\' // { \'known-positive\', \'newly-identified-positive\', \'newly-identified-negative\' }\ncodesystem \"PMTCT ART Status Codes\": \'TBD\' // { \'already-on-art\', \'new-on-art\' }\n\nvalueset \"HIV Testing Services\": \'TBD\' // Should use HIV tests\nvalueset \"Viral Load Test\": \'TBD\'\nvalueset \"HL7 Administrative Gender\": \'http://hl7.org/fhir/ValueSet/administrative-gender\'\nvalueset \"ART Medications\": \'TBD\' // ART medications\nvalueset \"Antenatal Care\": \'TBD\' // Antenatal Care\nvalueset \"Delivery Procedures\": \'urn:oid:2.16.840.1.113762.1.4.1045.59\' // Used by CMS113\nvalueset \"Human Immunodeficiency Virus (HIV) Laboratory Test Codes (Ab and Ag)\": \'urn:oid:2.16.840.1.113762.1.4.1056.50\' // Used by CMS349\n \n//. HIV Test Results\ncode \"HIV Negative\": code \'165815009\' from \"SNOMED-CT\" display \'HIV Negative\'\ncode \"HIV Positive\": code \'165816005\' from \"SNOMED-CT\" display \'HIV Positive\'\ncode \"HIV 1 and 2 tests - Meaningful Use set\": \'75622-1\' from \"LOINC\" display \'HIV 1 and 2 tests - Meaningful Use set\' // Used by CMS349\n\n// History of ART Therapy\ncode \"History of antiretroviral therapy (situation)\": \'432101000124108\' from \"SNOMED-CT\" display \'History of antiretroviral therapy (situation)\'\n\n// Age Groups\ncode \"P0Y--P1Y\": code \'P0Y--P1Y\' from \"ISO-8601-Derived Periods\" display \'< 1 year\'\ncode \"P1Y--P5Y\": code \'P1Y--P5Y\' from \"ISO-8601-Derived Periods\" display \'1-4 years\'\ncode \"P5Y--P10Y\": code \'P5Y--P10Y\' from \"ISO-8601-Derived Periods\" display \'5-9 year\'\ncode \"P10Y--P15Y\": code \'P10Y--P15Y\' from \"ISO-8601-Derived Periods\" display \'10-14 year\'\ncode \"P15Y--P20Y\": code \'P15Y--P20Y\' from \"ISO-8601-Derived Periods\" display \'15-19 year\'\ncode \"P20Y--P25Y\": code \'P20Y--P25Y\' from \"ISO-8601-Derived Periods\" display \'20-24 year\'\ncode \"P25Y--P30Y\": code \'P25Y--P30Y\' from \"ISO-8601-Derived Periods\" display \'25-29 year\'\ncode \"P30Y--P35Y\": code \'P30Y--P35Y\' from \"ISO-8601-Derived Periods\" display \'30-34 year\'\ncode \"P35Y--P40Y\": code \'P35Y--P40Y\' from \"ISO-8601-Derived Periods\" display \'35-39 year\'\ncode \"P40Y--P50Y\": code \'P40Y--P50Y\' from \"ISO-8601-Derived Periods\" display \'40-49 year\'\ncode \"P50Y--P9999Y\": code \'P50Y--P9999Y\' from \"ISO-8601-Derived Periods\" display \'50+ years\'\n\n// PMTCT ART status\ncode \"Already on ART\": \'already-on-art\' from \"PMTCT ART Status Codes\" display \'Already on ART\'\ncode \"New on ART\": \'new-on-art\' from \"PMTCT ART Status Codes\" display \'New on ART\' \n\n// PMTCT HIV status\ncode \"Known Positive\": \'known-positive\' from \"PMTCT HIV Status Codes\" display \'Known Positive\'\ncode \"Newly Identified Positive\": \'newly-identified-positive\' from \"PMTCT HIV Status Codes\" display \'Newly Identified Positive\'\ncode \"Newly Identified Negative\": \'newly-identified-negative\' from \"PMTCT HIV Status Codes\" display \'Newly Identified Negative\'\n\n// Pregnancy/Breastfeeding (PREG_BF)\ncode \"Pregnant\": \'146789000\' from \"SNOMED-CT\" display \'Pregnant\'\ncode \"Breastfeeding\": \'169750002\' from \"SNOMED-CT\" display \'Breastfeeding\'\n\nparameter \"Measurement Period\" Interval<DateTime>\n\ndefine \"ART Therapy Observation\":\n  [\"Observation\": \"History of antiretroviral therapy (situation)\"] O\n    where O.status = \'final\'\n\ndefine \"ART Therapy Condition\":\n  [\"Condition\": \"History of antiretroviral therapy (situation)\"] C\n    where C.verificationStatus = \'confirmed\'\n      and C.clinicalStatus in { \'active\', \'relapsed\', \'well-controlled\', \'poorly-controlled\' }\n\ndefine \"ART Therapy Medication\":\n  [\"MedicationDispense\": \"ART Medications\"] M\n    where M.status = \'completed\'\n  \ndefine \"ART Dates\":\n  (\"ART Therapy Observation\" O return O.effectiveDateTime) \n    union (\"ART Therapy Condition\" C return C.onsetDateTime)\n    union (\"ART Therapy Medication\" M return M.whenHandedOver)\n  \ndefine \"Date of First Evidence of ART\":\n  Min(\"ART Dates\")\n  \n// PMTCT ART status\ndefine \"PMTCT ART Status\":\n  case\n    when \"Date of First Evidence of ART\" before start of \"Measurement Period\" then \"Already On ART\"\n    when \"Date of First Evidence of ART\" during \"Measurement Period\" then \"New On ART\"\n    else null\n  end\n\n//code \"Already on ART\": \'432101000124108\' from \"SNOMED-CT\" display \'Already on ART\'\n//code \"New on ART\": \'432101000124108*\' from \"SNOMED-CT\" display \'New on ART\' \n\ndefine \"On ART\":\n  exists (\"ART Dates\" D where D during \"Measurement Period\")\n    or exists (\n      \"ART Therapy Condition\" C \n        where Interval[C.onsetDatetime, C.abatementDatetime] overlaps \"Measurement Period\"\n    )\n\ndefine \"HIV Test Observation\":\n  (\n    [Observation: \"Human Immunodeficiency Virus (HIV) Laboratory Test Codes (Ab and Ag)\"] \n      union [Observation: \"HIV 1 and 2 tests - Meaningful Use set\"]\n  ) O\n    where O.status = \'final\'\n      and O.value is not null\n\ndefine \"HIV Positive Observation\":\n  \"HIV Test Observation\" O where O.value ~ \"HIV Positive\"\n\ndefine \"HIV Negative Observation\":\n  \"HIV Test Observation\" O where O.value ~ \"HIV Negative\"\n\ndefine \"Is HIV Positive\":\n  exists (\"HIV Positive Observation\")\n  \ndefine \"Is HIV Negative\":\n  exists (\"HIV Negative Observation\")\n  \ndefine \"Date of First Evidence of HIV Status\":\n  Min(\"HIV Test Observation\" O return O.effectiveDateTime)\n  \ndefine \"Date of First Evidence of HIV Positive\":\n  Min(\"HIV Positive Observation\" O return O.effectiveDateTime)\n\ndefine \"Date of First Evidence of HIV Negative\":\n  Min(\"HIV Negative Observation\" O return O.effectiveDateTime)\n  \n// PMTCT HIV Status\ndefine \"PMTCT HIV Status\":\n  case\n    when \"Date of First Evidence of HIV Positive\" before start of \"Measurement Period\" then \'Known Positive\'\n    when \"Date of First Evidence of HIV Positive\" during \"Measurement Period\" then \'Newly Identified Positive\'\n    when \"Date of First Evidence of HIV Negative\" during \"Mesaurement Period\" then \'Newly Identified Negative\'\n    else null\n  end\n  \n//code \"Known HIV positive\": code \'165816005**\' from \"SNOMED-CT\" display \'Known HIV positive\'\n//code \"Newly identified HIV Positive\": code \'165816005*\' from \"SNOMED-CT\" display \'Newly identified HIV Positive\'\n//code \"Newly identified HIV negative\": code \'165815009*\' from \"SNOMED-CT\" display \'Newly identified HIV negative\'\n\n// QRPH_ADX_ART1_N:\n// Number of adults and children newly enrolled on antiretroviral therapy (ART) in the reporting period\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Newly enrolled on antiretroviral therapy (ART) during measurement period\":\n  \"Date of First Evidence of ART\" during \"Measurement Period\"\n\n// QRPH_ADX_ART1_N_PREG_BF:\n// Number of adults and children newly enrolled on ART in the reporting period_pregnant and breastfeeding\n  // Stratifiers: PREG_BF\ndefine \"Newly enrolled on antiretroviral therapy (ART) during measurement period (pregnant and breastfeeding)\":\n  \"Is Pregnant\" and \"Is Breastfeeding\" and \"Date of First Evidence of ART\" during \"Measurement Period\"\n  \n// QRPH_ADX_ART3_N:\n// Number of adults and children currently receiving antiretroviral therapy (ART)\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Receiving antiretroviral therapy (ART) during measurement period\":\n  exists (\"ART Dates\" D where D during \"Measurement Period\")\n    or exists (\n      \"ART Therapy Condition\" C \n        where Interval[C.onsetDatetime, C.abatementDatetime] overlaps \"Measurement Period\"\n    )\n    \ndefine \"Year Preceding the Measurement Period\":\n  Interval[start of \"Measurement Period\" - 1 year, start of \"Measurement Period\")\n  \ndefine \"Month Before the Year Preceding the Measurement Period\":\n  Interval[start of \"Year Preceding the Measurement Period\" - 1 month, start of \"Year Preceding the Measurement Period\")\n  \n// QRPH_ADX_ART5_N:\n// Number of adults and children who are still on treatment at 12 months after initiating ART\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Receiving antiretroviral therapy (ART) at 12 months after initiating\":\n  \"Date of First Evidence of ART\" during \"Month Before the Year Preceding the Measurement Period\"\n    and \"Receiving antiretroviral therapy (ART) during Measurement Period\"\n\n// QRPH_ADX_ART5_N_PREG_BF:\n// Number of adults and children who are still on treatment at 12 months after initiating ART-pregnant and breastfeeding\n  // Stratifiers: PREG_BF\ndefine \"Receiving antiretroviral therapy (ART) at 12 months after initiating (pregnant and breastfeeding)\":\n  \"Receiving antiretroviral therapy (ART) at 12 months after initiating\"\n    and \"Is Pregnant\"\n    and \"Is Breastfeeding\"\n\n// QRPH_ADX_ART5_D:\n// Number of adults and children who initiated ART in the 12 months prior to the beginning of the reporting period\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Initiated antiretroviral therapy (ART) in the 12 months prior to measurement period\":\n  \"Date of First Evidence of ART\" during \"Year Preceding the Measurement Period\"\n\ndefine \"Antenatal Care Visit\":\n  [Encounter: \"Antenatal Care\"] E\n    where E.status = \'finished\'\n      and E.period during Interval[start of \"Year Preceding the Measurement Period\", end of \"Measurement Period\"]\n    \ndefine \"Live Birth Procedure\":\n  [Procedure: \"Live Birth\"] P\n    where P.status = \'completed\'\n    \n// QRPH_ADX_MTCT1_D:\n// Number of pregnant women who attended ANC or had a facility-based delivery in the reporting period\n // Stratifiers: PMTCT_HIV_STATUS\ndefine \"Antenatal Care Visit or Live Birth during the Measurement Period\":\n  (\"Is Pregnant\" and exists (\"Antenatal Care Visit\" V where V.period during \"Measurement Period\"))\n    or exists (\"Live Birth Procedure\" P where P.performed during \"Measurement Period\")\n\n// QRPH_ADX_MTCT2_D:\n// Number of HIV positive pregnant women who attended ANC or had a facility-based delivery within the reporting period\n  // Stratifiers: None\ndefine \"Antenatal Care Visit or Live Birth during Measurement Period (HIV Positive)\":\n  \"Is HIV Positive\"\n    and \"Antenatal Care Visit or Live Birth during Measurement Period\"\n\n// QRPH_ADX_MTCT2_N:\n// Number of HIV-positive pregnant women who received ART to reduce the risk of mother-to-child-transmission during pregnancy\n  // Stratifiers: PMTCT_ART_STATUS\ndefine \"HIV-positive, pregnant, and receiving antiretroviral therapy (ART) to reduce the risk of mother-to-child-transmission during pregnancy\":\n  \"Is HIV Positive\"\n    and \"Is Pregnant\"\n    and \"Receiving antiretroviral therapy (ART) during measurement period\"\n\ndefine \"Viral Load Test Result\":\n  [\"Observation\": \"Viral Load Test\"] O\n    where O.status = \'final\'\n      and O.value is not null\n\n// QRPH_ADX_VLS3_N:\n// Number of people living with HIV and on ART who have a suppressed viral load results (&lt;1000 copies/mL).\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Living with HIV and on ART with suppressed viral load results (<1000 copies/mL)\":\n  \"Is HIV Positive\"\n    and \"Receiving antiretroviral therapy (ART) during measurement period\"\n    and exists (\n      \"Viral Load Test Result\" R\n        where R.effectiveDateTime during \"Measurement Period\"\n          and R.value < 1000 \'{copies}/mL\'\n      )\n      \n// QRPH_ADX_HTS2_N:\n// Number of individuals who received HIV Testing Services (HTS) and received their test results\n  // Stratifiers: AGE_GROUP,SEX,HIV_TEST_RESULTS\ndefine \"Received HIV Testing Services (HTS) and Recevied Test Results\":\n  [\"Observation\": \"HIV Testing Services\"] O\n    where O.status = \'final\'\n      and O.value is not null  \n\ndefine \"First antenatal care visit\":\n  First(\"Antenatal Care Visit\" V sort by start of period)\n\n// QRPH_ADX_MTCT1_N:\n// Number of pregnant women with known HIV status at first antenatal care visit\n  // Stratifiers: PMTCT_HIV_STATUS\ndefine \"HIV Status Known at First Antenatal Care Visit\":\n  \"Date of First Evidence of HIV Status\" on or before start of \"First antenatal care visit\".period\n\n// QRPH_ADX_VLS3_D:\n// Number of people on ART who had a VL measurement in the past 12 months.\n  // Stratifiers: AGE_GROUP,SEX\ndefine \"Receiving antiretroviral therapty (ART) and Viral Load Measurement in the past 12 months\":\n  \"Receiving antiretroviral therapy (ART) during measurement period\"\n    and exists (\n      \"Viral Load Test Result\" R\n        where R.effectiveDateTime during \"Year Preceding the Measurement Period\"\n    )\n\n\n// Stratifiers\n\n// Age Group\ndefine \"Age Group\":\n  case\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[0, 1) then \"P0Y--P1Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[1, 5) then \"P1Y--P5Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[5, 10) then \"P5Y--P10Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[10, 15) then \"P10Y--P15Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[15, 20) then \"P15Y--P20Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[20, 25) then \"P20Y--P25Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[25, 30) then \"P25Y--P30Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[30, 35) then \"P30Y--P35Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[35, 40) then \"P35Y--P40Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[40, 50) then \"P40Y--P50Y\"\n    when AgeInYearsAt(start of \"Measurement Period\") in Interval[50, null] then \"P50Y--P9999Y\"\n    else null\n  end\n\n// Sex\ndefine \"Sex\": Patient.gender\n\n// Age Group/Sex\ndefine \"Age Group/Sex\": \"Age Group\".code + \':\' + \"Sex\"\n\n// Pregnant/Breastfeeding\ndefine \"Pregnant/Breastfeeding\":\n  case\n    when \"Is Pregnant\" then \"Pregnant\"\n    when \"Is Breastfeeding\" then \"Breastfeeding\"\n    else null\n  end\n  \n// HIV Test Results\ndefine \"HIV Test Results\":\n  case\n    when \"Is HIV Positive\" then \"HIV Positive\"\n    when \"Is HIV Negative\" then \"HIV Negative\"\n    else null\n  end\n  \ndefine \"Age Group/Sex/HIV Test Results\":\n  \"Age Group\".code + \':\' + \"Sex\" + \":\" + \"HIV Test Result\".code\n"
  }
  url {
    value: "library-hiv-indicators-content.cql"
  }
}
