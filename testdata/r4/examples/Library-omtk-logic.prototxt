id {
  value: "omtk-logic"
}
text {
  status {
    value: GENERATED
  }
  div {
    value: "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p><b>Generated Narrative with Details</b></p><p><b>id</b>: omtk-logic</p><p><b>identifier</b>: OMTKLogic (OFFICIAL)</p><p><b>version</b>: 0.1.0</p><p><b>title</b>: OMTK Logic</p><p><b>status</b>: active</p><p><b>experimental</b>: true</p><p><b>type</b>: Logic Library <span>(Details : {http://terminology.hl7.org/CodeSystem/library-type code \'logic-library\' = \'Logic Library\', given as \'Logic Library\'})</span></p><p><b>date</b>: 05/05/2017</p><p><b>publisher</b>: Centers for Disease Control and Prevention (CDC)</p><p><b>description</b>: Opioid Management Terminology Knowledge Base Logic for use in implementing CDC Opioid Prescribing Guidelines.</p><p><b>useContext</b>: , </p><p><b>jurisdiction</b>: United States of America <span>(Details : {urn:iso:std:iso:3166 code \'US\' = \'United States of America\', given as \'United States of America\'})</span></p><p><b>purpose</b>: This library normalizes units to UCUM units, identifies the conversion factor for the given ingredient, identifies the non-surgical opioid ingredients and their strengths that make up a drug identified by the given rxNormCode, calculates daily dose for a specific ingredient based on the ingredient strength, dose form, dose quantity, and daily frequency, calculates daily frequency given frequency within a period, and calculates the Morphine Milligram Equivalency (MME) for a given prescription.</p><p><b>usage</b>: This library is used to gather information about an opioid prescription necessary to offer opioid management guidance for a patient.</p><p><b>copyright</b>: \302\251 CDC 2016+.</p><p><b>topic</b>: Opioid Prescribing <span>(Details )</span></p><p><b>author</b>: , , , </p><p><b>relatedArtifact</b>: , , </p><p><b>content</b>: , </p></div>"
  }
}
identifier {
  use {
    value: OFFICIAL
  }
  value {
    value: "OMTKLogic"
  }
}
version {
  value: "0.1.0"
}
title {
  value: "OMTK Logic"
}
status {
  value: ACTIVE
}
experimental {
  value: true
}
type {
  coding {
    system {
      value: "http://terminology.hl7.org/CodeSystem/library-type"
    }
    code {
      value: "logic-library"
    }
    display {
      value: "Logic Library"
    }
  }
}
date {
  value_us: 1493906400000000
  timezone: "Australia/Sydney"
  precision: DAY
}
publisher {
  value: "Centers for Disease Control and Prevention (CDC)"
}
description {
  value: "Opioid Management Terminology Knowledge Base Logic for use in implementing CDC Opioid Prescribing Guidelines."
}
use_context {
  code {
    system {
      value: "http://terminology.hl7.org/CodeSystem/usage-context-type"
    }
    code {
      value: "focus"
    }
    display {
      value: "Clinical Focus"
    }
  }
  value {
    codeable_concept {
      coding {
        system {
          value: "http://snomed.info/sct"
        }
        code {
          value: "182888003"
        }
        display {
          value: "Medication requested (situation)"
        }
      }
    }
  }
}
use_context {
  code {
    system {
      value: "http://terminology.hl7.org/CodeSystem/usage-context-type"
    }
    code {
      value: "focus"
    }
    display {
      value: "Clinical Focus"
    }
  }
  value {
    codeable_concept {
      coding {
        system {
          value: "http://snomed.info/sct"
        }
        code {
          value: "82423001"
        }
        display {
          value: "Chronic pain (finding)"
        }
      }
    }
  }
}
jurisdiction {
  coding {
    system {
      value: "urn:iso:std:iso:3166"
    }
    code {
      value: "US"
    }
    display {
      value: "United States of America"
    }
  }
}
purpose {
  value: "This library normalizes units to UCUM units, identifies the conversion factor for the given ingredient, identifies the non-surgical opioid ingredients and their strengths that make up a drug identified by the given rxNormCode, calculates daily dose for a specific ingredient based on the ingredient strength, dose form, dose quantity, and daily frequency, calculates daily frequency given frequency within a period, and calculates the Morphine Milligram Equivalency (MME) for a given prescription."
}
usage {
  value: "This library is used to gather information about an opioid prescription necessary to offer opioid management guidance for a patient."
}
copyright {
  value: "\302\251 CDC 2016+."
}
topic {
  text {
    value: "Opioid Prescribing"
  }
}
author {
  name {
    value: "Kensaku Kawamoto, MD, PhD, MHS"
  }
}
author {
  name {
    value: "Bryn Rhodes"
  }
}
author {
  name {
    value: "Floyd Eisenberg, MD, MPH"
  }
}
author {
  name {
    value: "Robert McClure, MD, MPH"
  }
}
related_artifact {
  type {
    value: DEPENDS_ON
  }
  resource {
    value: "Library/omtk-modelinfo"
  }
}
related_artifact {
  type {
    value: DOCUMENTATION
  }
  display {
    value: "CDC guideline for prescribing opioids for chronic pain"
  }
  url {
    value: "https://guidelines.gov/summaries/summary/50153/cdc-guideline-for-prescribing-opioids-for-chronic-pain---united-states-2016#420"
  }
}
related_artifact {
  type {
    value: DOCUMENTATION
  }
  display {
    value: "MME Conversion Tables"
  }
  url {
    value: "https://www.cdc.gov/drugoverdose/pdf/calculating_total_daily_dose-a.pdf"
  }
}
content {
  content_type {
    value: "text/cql"
  }
  data {
    value: "library OMTKLogic version \'0.1.0\'\r\n\r\nusing OMTK version \'0.1.0\'\r\n\r\ncodesystem RxNorm: \'http://www.nlm.nih.gov/research/umls/rxnorm\'\r\n\r\n//define MED_DOSE_FORMS: [MED_DOSE_FORM]\r\n\r\n// Given an RxNorm Code:\r\n// NON_SURGICAL_OPIOID_TO_INCLUDE.DRUG_RXCUI\r\n// MED_DRUG.DRUG_RXCUI\r\n// MED_SCDC_FOR_DRUG.DRUG_RXCUI -> SCDC_RXCUI\r\n// MED_SCDC.SCDC_RXCUI (STRENGTH, STRENGTH_VALUE, STRENGTH_UNIT)\r\n// MED_INGREDIENT_FOR_SCDC.SCDC_RXCUI -> INGREDIENT_RXCUI\r\n// MED_INGREDIENT.INGREDIENT_RXCUI\r\n// MED_INGREDIENT_TYPE.INGREDIENT_RXCUI (INGREDIENT_TYPE = \'NonSurgicalOpioid\')\r\n\r\n/*\r\n SQL ->\r\nselect D.DRUG_RXCUI, D.DRUG_NAME, DF.DOSE_FORM_NAME, SCDCD.SCDC_RXCUI, SCDC.SCDC_NAME, SCDC.STRENGTH, SCDC.STRENGTH_VALUE, SCDC.STRENGTH_UNIT, I.INGREDIENT_RXCUI, I.INGREDIENT_NAME\r\n  from MED_DRUG D\r\n    join NON_SURGICAL_OPIOID_TO_INCLUDE NSO on D.DRUG_RXCUI = NSO.DRUG_RXCUI\r\n    join MED_SCDC_FOR_DRUG SCDCD on D.DRUG_RXCUI = SCDCD.DRUG_RXCUI\r\n    join MED_SCDC SCDC on SCDCD.SCDC_RXCUI = SCDC.SCDC_RXCUI\r\n    join MED_INGREDIENT_FOR_SCDC SCDCI on SCDC.SCDC_RXCUI = SCDCI.SCDC_RXCUI\r\n    join MED_INGREDIENT I on SCDCI.INGREDIENT_RXCUI = I.INGREDIENT_RXCUI\r\n    join MED_INGREDIENT_TYPE IT on I.INGREDIENT_RXCUI = IT.INGREDIENT_RXCUI\r\n\tleft join MED_DRUG_DOSE_FORM DDF on D.DRUG_RXCUI = DDF.DRUG_RXCUI\r\n\tleft join MED_DOSE_FORM DF on DDF.DOSE_FORM_RXCUI = DF.DOSE_FORM_RXCUI\r\n\t--Most of the drugs have multiple dose form groups...\r\n\t--left join MED_DRUG_DOSE_FORM_GROUP DDFG on D.DRUG_RXCUI = DDFG.DRUG_RXCUI\r\n\t--left join MED_DOSE_FORM_GROUP DFG on DDFG.DOSE_FORM_GROUP_RXCUI = DFG.DOSE_FORM_GROUP_RXCUI\r\n  where D.DRUG_RXCUI = @RxNormCode // 197696\r\n    and IT.INGREDIENT_TYPE = \'NonSurgicalOpioid\'\r\n*/\r\n\r\n/*\r\n  CQL, assuming translation to SQL:\r\n\r\n  from\r\n    [MED_DRUG: rxNormCode] D,\r\n    [NON_SURGICAL_OPIOID_TO_INCLUDE] NSO,\r\n    [MED_SCDC_FOR_DRUG] SCDCD,\r\n    [MED_SCDC] SCDC,\r\n    [MED_INGREDIENT_FOR_SCDC] SCDCI,\r\n    [MED_INGREDIENT] I,\r\n    [MED_INGREDIENT_TYPE] IT,\r\n    [MED_DRUG_DOSE_FORM] DDF,\r\n    [MED_DOSE_FORM] DF\r\n  where D.DRUG_RXCUI = NSO.DRUG_RXCUI\r\n    and D.DRUG_RXCUI = SCDCD.DRUG_RXCUI\r\n    and SCDCD.SCDC_RXCUI = SCDC.SCDC_RXCUI\r\n    and SCDC.SCDC_RXCUI = SCDCI.SCDC_RXCUI\r\n    and SDCDI.INGREDIENT_RXCUI = I.INGREDIENT_RXCUI\r\n    and I.INGREDIENT_RXCUI = IT.INGREDIENT_RXCUI\r\n    and D.DRUG_RXCUI = DDF.DRUG_RXCUI\r\n    and DDF.DOSE_FORM_RXCUI = DF.DOSE_FORM_RXCUI\r\n    and IT.INGREDIENT_TYPE = \'NonSurgicalOpioid\'\r\n*/\r\n\r\n/*\r\nAn engine with a naive implementation for multi-source queries would perform\r\npretty horribly here, so rewrite it using \"syntactic optimization\" :)\r\n*/\r\n\r\n/*\r\n  Normalizes the input units to UCUM units\r\n  \r\n  Note guidance for UCUM presentation of medication units from SNOMED here:\r\n  https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=0ahUKEwjU3vLpicPTAhWFMGMKHRpOBUAQFggiMAA&url=https%3A%2F%2Fconfluence.ihtsdotools.org%2Fdownload%2Fattachments%2F17859188%2FExpressing%2520Units%2520of%2520Measure%2520for%2520Medicinal%2520Products.doc%3Fapi%3Dv2&usg=AFQjCNE5sboicqvJDUyXJ2im8VzBpgHE8A\r\n  \r\n  The values listed here are the only ones currently present in the OMTK data\r\n  \r\n  Based on the HL7 UCUM subset here:\r\n  http://download.hl7.de/documents/ucum/ucumdata.html\r\n*/\r\ndefine function ToUCUM(unit String):\r\n  case unit\r\n    when \'MG\' then \'mg\'\r\n    when \'MG/ACTUAT\' then \'mg/{actuat}\'\r\n    when \'MG/HR\' then \'mg/h\'\r\n    when \'MG/ML\' then \'mg/mL\'\r\n    else \'unknown{\' + unit + \'}\' // Should probably be an error\r\n  end\r\n\r\n/*\r\n  Calculates daily frequency given frequency within a period\r\n*/\r\ndefine function ToDaily(frequency Integer, period System.Quantity):\r\n  case period.unit\r\n    when \'h\' then frequency * (24.0 / period.value)\r\n    when \'min\' then frequency * (24.0 / period.value) * 60\r\n    when \'s\' then frequency * (24.0 / period.value) * 60 * 60\r\n    when \'d\' then frequency * (24.0 / period.value) / 24\r\n    when \'wk\' then frequency * (24.0 / period.value) / (24 * 7)\r\n    when \'mo\' then frequency * (24.0 / period.value) / (24 * 30) // assuming 30 days in month\r\n    when \'a\' then frequency * (24.0 / period.value) / (24 * 365) // assuming 365 days in year\r\n    else null\r\n  end\r\n\r\n/*\r\n  Returns true if the given dose form is a patch (transdermal system)\r\n*/\r\ndefine function IsPatch(doseFormCode Code):\r\n  ToInteger(doseFormCode.code) = 316987\r\n\r\n/*\r\n  Returns the conversion factor for the given ingredient\r\n\r\nOpioid (strength in mg except where noted)\tMME Conversion Factor*\r\nBuprenorphine, transdermal patch (MCG/HR)\t12.6\r\nBuprenorphine, tablet or film\t30\r\nBuprenorphine, film (MCG)\t0.03\r\nButorphanol\t7\r\nCodeine\t0.15\r\nDihydrocodeine\t0.25\r\nFentanyl, buccal/SL tabet or lozenge/troche (MCG)\t0.13\r\nFentanyl, film or oral spray (MCG)\t0.18\r\nFentanyl, nasal spray (MCG)\t0.16\r\nFentanyl, transdermal patch (MCG/HR)\t7.2\r\nHydrocodone\t1\r\nHydromorphone\t4\r\nLevomethadyl acetate\t8\r\nLevorphanol tartrate\t11\r\nMeperidine \t0.1\r\nMethadone\t3\r\n  1-20 mg/d 4\r\n  21-40 mg/d 8\r\n  41-60 mg/d 10\r\n  61-80 mg/d 12\r\nMorphine\t1\r\nOpium\t1 // NOTE: Not present as an ingredient in the RxNorm data\r\nOxycodone\t1.5\r\nOxymorphone\t3\r\nPentazocine\t0.37\r\nTapentadol\t0.4\r\nTramadol\t0.1\r\n\r\n*/\r\ndefine function GetConversionFactor(ingredientCode Code, dailyDose Quantity, doseFormCode Code):\r\n  case ToInteger(ingredientCode.code)\r\n    when 161 then 0 //\tAcetaminophen\r\n    when 1191 then 0 //\tAspirin\r\n    when 1223 then 0 //\tAtropine\r\n    when 1767 then 0 //\tBrompheniramine\r\n    when 1819 then ( //\tBuprenorphine\r\n      case \r\n        when ToInteger(doseFormCode.code) = 316987 then 12.6 // Transdermal system\r\n        else 30 // Tablet or Film (or Film in MCG)\r\n      end\r\n    ) \r\n    when 1841 then 7 //\tButorphanol\r\n    when 1886 then 0 //\tCaffeine\r\n    when 2101 then 0 //\tCarisoprodol\r\n    when 2354 then 0 //\tchlorcyclizine\r\n    when 2400 then 0 //\tChlorpheniramine\r\n    when 2670 then 0.15 //\tCodeine\r\n    when 3423 then 4 //\tHydromorphone\r\n    when 3498 then 0 //\tDiphenhydramine\r\n    when 4337 then ( //\tFentanyl\r\n      case\r\n        when ToInteger(doseFormCode.code) in { 970789, 317007, 316992 } then 0.13 // Buccal Tablet, Sublingual Tablet, Oral Lozenge\r\n        when ToInteger(doseFormCode.code) = 346163 then 0.18 // Buccal Film\r\n        when ToInteger(doseFormCode.code) in { 126542, 346163 } then 0.16 // Nasal Spray, Mucosal Spray\r\n        when IsPatch(doseFormCode) then 7.2 // Transdermal system\r\n        else 1000 // Really ought to be an error because it represents a previously unencountered dose form....\r\n      end\r\n    )\r\n    when 5032 then 0 //\tGuaifenesin\r\n    when 5489 then 1 //\tHydrocodone\r\n    when 5640 then 0 //\tIbuprofen\r\n    when 6102 then 0 //\tKaolin\r\n    when 6378 then 11 //\tLevorphanol (NOTE: Given as Levorphanol tartrate in the CDC conversion table)\r\n    when 6754 then 0.1 //\tMeperidine\r\n    when 6813 then ( //\tMethadone\r\n      case\r\n        when dailyDose.value between 1 and 20 then 4\r\n        when dailyDose.value between 21 and 40 then 8\r\n        when dailyDose.value between 41 and 60 then 10\r\n        when dailyDose.value >= 61 then 12\r\n        else 1000 // Really ought to be an error because it represents an unexpected dose range...\r\n      end\r\n    )\r\n    when 7052 then 1 //\tMorphine\r\n    when 7242 then 0 //\tNaloxone\r\n    when 7243 then 0 //\tNaltrexone\r\n    when 7804 then 1.5 //\tOxycodone\r\n    when 7814 then 3 //\tOxymorphone\r\n    when 8001 then 0.37 //\tPentazocine\r\n    when 8163 then 0 //\tPhenylephrine\r\n    when 8175 then 0 //\tPhenylpropanolamine\r\n    when 8745 then 0 //\tPromethazine\r\n    when 8896 then 0 //\tPseudoephedrine\r\n    when 9009 then 0 //\tPyrilamine\r\n    when 10689 then 0.1 //\tTramadol\r\n    when 10849 then 0 //\tTriprolidine\r\n    when 19759 then 0 //\tbromodiphenhydramine\r\n    when 19860 then 0 //\tbutalbital\r\n    when 22696 then 0 //\tdexbrompheniramine\r\n    when 22697 then 0 //\tdexchlorpheniramine\r\n    when 23088 then 0.25 //\tdihydrocodeine\r\n    when 27084 then 0 //\thomatropine\r\n    when 35780 then 0 //\tropivacaine\r\n    when 237005 then 8 //\tLevomethadyl (NOTE: given as Levomethadyl acetate in the CDC conversion table)\r\n    when 636827 then 0 //\tguaiacolsulfonate\r\n    when 787390 then 0.4 //\ttapentadol\r\n    else 0\r\n  end\r\n\r\ndefine function EnsureMicrogramQuantity(strength Quantity):\r\n  if strength.value < 0.1 and (PositionOf(\'mg\', strength.unit) = 0) then\r\n    Quantity {\r\n      value: strength.value * 1000,\r\n      unit: \'mcg\' + Substring(strength.unit, 2)\r\n    }\r\n  else\r\n    strength\r\n\r\n/*\r\n  Returns the non-surgical opioid ingredients and their strengths that\r\n  make up the drug identified by the given rxNormCode as a list of tuples:\r\n\r\n  List<Tuple {\r\n    rxNormCode Code,\r\n    doseFormCode Code,\r\n    doseFormName String,\r\n    ingredientCode Code,\r\n    ingredientName String,\r\n    strength Quantity\r\n  }>\r\n*/\r\ndefine function GetIngredients(rxNormCode Code):\r\n  (\r\n    [MED_SCDC_FOR_DRUG: DRUG_RXCUI in rxNormCode] SD\r\n      where exists ([MED_DRUG_VALUE_SET: DRUG_RXCUI in SD.DRUG_RXCUI])\r\n      return {\r\n        rxNormCode: rxNormCode,\r\n        component: SingletonFrom([MED_SCDC: SCDC_RXCUI in SD.SCDC_RXCUI]),\r\n        ingredientCode: SingletonFrom([MED_SCDC: SCDC_RXCUI in SD.SCDC_RXCUI]).INGREDIENT_RXCUI,\r\n        doseFormCode: SingletonFrom([MED_DRUG: DRUG_RXCUI in SD.DRUG_RXCUI]).DOSE_FORM_RXCUI // Could potentially look this up only once...\r\n      }\r\n  ) C\r\n    let\r\n      ingredient: SingletonFrom([MED_INGREDIENT: INGREDIENT_RXCUI in C.ingredientCode]),\r\n      doseForm: SingletonFrom([MED_DOSE_FORM: DOSE_FORM_RXCUI in C.doseFormCode])\r\n    where exists (\r\n      [MED_INGREDIENT_TYPE: INGREDIENT_RXCUI in C.ingredientCode] IT\r\n        where IT.INGREDIENT_TYPE = \'Opioid_NonSurgical\'\r\n    )\r\n    return {\r\n      rxNormCode: rxNormCode,\r\n      doseFormCode: C.doseFormCode,\r\n      doseFormName: doseForm.DOSE_FORM_NAME,\r\n      ingredientCode: C.ingredientCode,\r\n      ingredientName: ingredient.INGREDIENT_NAME,\r\n      strength:\r\n        EnsureMicrogramQuantity(\r\n          Quantity {\r\n            value: C.component.STRENGTH_VALUE,\r\n            unit: ToUCUM(C.component.STRENGTH_UNIT)\r\n          }\r\n        )\r\n    }\r\n\r\n/*\r\n  Calculates daily dose for a specific ingredient based on the ingredient strength, dose form, dose quantity, and daily frequency\r\n*/\r\ndefine function GetDailyDose(ingredientCode Code, strength Quantity, doseFormCode Code, doseQuantity Quantity, dosesPerDay Decimal):\r\n  case\r\n\t  // if patch --> daily dose = dose value (e.g, number patches with doseQuantity unit = \"patch\") * per-hour strength\r\n    when IsPatch(doseFormCode) then\r\n      // buprenorphine or fentanyl patch\r\n      if ToInteger(ingredientCode.code) in { 1819, 4337 } then\r\n        Quantity { value: dosesPerDay * doseQuantity.value * strength.value, unit: strength.unit }\r\n      else\r\n        null\r\n\r\n    // if dose unit in actual mass units (mg or mcg -- when it\'s a single med) --> daily dose = numTimesPerDay * dose\r\n    when doseQuantity.unit in { \'mg\', \'mcg\' } then\r\n      Quantity { value: dosesPerDay * doseQuantity.value, unit: doseQuantity.unit }\r\n\r\n    // if doseQuantity is in actual volume units (mL) --> daily dose = numTimesPerDay * dose * strength\r\n    when doseQuantity.unit = \'mL\' and (PositionOf(\'/mL\', strength.unit) = Length(strength.unit) - 3) then\r\n      Quantity { value: dosesPerDay * doseQuantity.value * strength.value, unit: Substring(strength.unit, 0, PositionOf(\'/\', strength.unit)) }\r\n\r\n\t\t// if doseQuantity is not in actual units (e.g., 1 tab, 1 spray -- when it\'s a combo med with a unit of tablet, or it\'s mg/actuat) --> daily dose = numTimesPerDay * dose value * strength value\r\n    else\r\n      Quantity { value: dosesPerDay * doseQuantity.value * strength.value, unit: Substring(strength.unit, 0, PositionOf(\'/\', strength.unit)) }\r\n  end\r\n  \r\ndefine function GetMedicationName(rxNormCode Code):\r\n  SingletonFrom([MED_DRUG: DRUG_RXCUI in rxNormCode]).DRUG_NAME\r\n\r\n/*\r\n  Builds a description for the daily dose for an ingredient\r\n*/\r\ndefine function GetDailyDoseDescription(ingredientCode Code, ingredientName String, strength Quantity, doseFormCode Code, doseFormName String, doseQuantity Quantity, dosesPerDay Decimal, dailyDose Quantity):\r\n  case\r\n    // if patch\r\n    when IsPatch(doseFormCode) then\r\n      // buprenorphine or fentanyl patch\r\n      if ToInteger(ingredientCode.code) in { 1819, 4337 } then\r\n        ingredientName + \' patch: \' + ToString(doseQuantity.value) + \' * \' + ToString(strength) + \' = \' + ToString(dailyDose)\r\n      else\r\n        null\r\n\r\n    // if dose unit in actual mass units (mg or mcg -- when it\'s a single med)\r\n    when doseQuantity.unit in { \'mg\', \'mcg\' } then\r\n      ingredientName + \' \' + doseFormName + \': \' + ToString(dosesPerDay) + \'/d * \' + ToString(doseQuantity) + \' = \' + ToString(dailyDose)\r\n\r\n    // if doseQuantity in actual volume units (mL) or not in actual units (e.g. 1 tab, 1 spray)\r\n    else\r\n      ingredientName + \' \' + doseFormName + \': \' + ToString(dosesPerDay) + \'/d * \' + ToString(doseQuantity) + \' * \' + ToString(strength) + \' = \' + ToString(dailyDose)\r\n  end\r\n\r\n/*\r\n  Calculates MMEs for the given input prescription information and returns it\r\n  as a list of tuples:\r\n\r\n  List<Tuple {\r\n    rxNormCode Code,\r\n    doseFormCode Code,\r\n    doseQuantity Quantity,\r\n    dosesPerDay Decimal,\r\n    ingredientCode Code,\r\n    ingredientName String,\r\n    strength Quantity,\r\n    dailyDose Quantity,\r\n    dailyDoseDescription String,\r\n    conversionFactor Decimal,\r\n    mme Quantity\r\n  }>\r\n*/\r\ndefine function CalculateMMEs(medications List<Tuple { rxNormCode Code, doseQuantity Quantity, dosesPerDay Decimal }>):\r\n  Flatten(\r\n    medications M\r\n      let Ingredients: GetIngredients(M.rxNormCode)\r\n      return\r\n        Ingredients I\r\n          let\r\n            adjustedDoseQuantity: EnsureMicrogramQuantity(M.doseQuantity),\r\n            dailyDose: GetDailyDose(I.ingredientCode, I.strength, I.doseFormCode, adjustedDoseQuantity, M.dosesPerDay),\r\n            factor: GetConversionFactor(I.ingredientCode, dailyDose, I.doseFormCode)\r\n          return {\r\n            rxNormCode: M.rxNormCode,\r\n            doseFormCode: I.doseFormCode,\r\n            doseQuantity: adjustedDoseQuantity,\r\n            dosesPerDay: M.dosesPerDay,\r\n            ingredientCode: I.ingredientCode,\r\n            ingredientName: I.ingredientName,\r\n            strength: I.strength,\r\n            dailyDose: dailyDose,\r\n            dailyDoseDescription: GetDailyDoseDescription(I.ingredientCode, I.ingredientName, I.strength, I.doseFormCode, I.doseFormName, adjustedDoseQuantity, M.dosesPerDay, dailyDose),\r\n            conversionFactor: factor,\r\n            mme: Quantity {\r\n              value: dailyDose.value * factor,\r\n              unit: dailyDose.unit + \'/d\'\r\n            }\r\n          }\r\n  )\r\n\r\ndefine TestCalculateMMEs:\r\n  CalculateMMEs({ { rxNormCode: Code \'388508\' from RxNorm, doseQuantity: Quantity { value: 1, unit: \'patch\' }, dosesPerDay: 0.33 } })"
  }
  url {
    value: "cql/OMTKLogic-0.1.0.cql"
  }
}
content {
  content_type {
    value: "application/elm+xml"
  }
  data {
    value: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<library xmlns=\"urn:hl7-org:elm:r1\" xmlns:t=\"urn:hl7-org:elm-types:r1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:fhir=\"http://hl7.org/fhir\" xmlns:a=\"urn:hl7-org:cql-annotations:r1\">\n   <identifier id=\"OMTKLogic\" version=\"0.1.0\"/>\n   <schemaIdentifier id=\"urn:hl7-org:elm\" version=\"r1\"/>\n   <usings>\n      <def localIdentifier=\"System\" uri=\"urn:hl7-org:elm-types:r1\"/>\n      <def localId=\"1\" localIdentifier=\"OMTK\" uri=\"http://org.opencds/opioid-cds\" version=\"0.1.0\"/>\n   </usings>\n   <codeSystems>\n      <def localId=\"2\" name=\"RxNorm\" id=\"http://www.nlm.nih.gov/research/umls/rxnorm\" accessLevel=\"Public\"/>\n   </codeSystems>\n   <statements>\n      <def localId=\"23\" name=\"ToUCUM\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"23\">\n               <a:s>define function ToUCUM(unit </a:s>\n               <a:s r=\"3\">\n                  <a:s>String</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"22\">\n                  <a:s r=\"22\">\n                     <a:s>case </a:s>\n                     <a:s r=\"4\">\n                        <a:s>unit</a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"7\">\n                        <a:s>when </a:s>\n                        <a:s r=\"5\">\n                           <a:s>\'MG\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"6\">\n                           <a:s>\'mg\'</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"10\">\n                        <a:s>when </a:s>\n                        <a:s r=\"8\">\n                           <a:s>\'MG/ACTUAT\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"9\">\n                           <a:s>\'mg/{actuat}\'</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"13\">\n                        <a:s>when </a:s>\n                        <a:s r=\"11\">\n                           <a:s>\'MG/HR\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"12\">\n                           <a:s>\'mg/h\'</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"16\">\n                        <a:s>when </a:s>\n                        <a:s r=\"14\">\n                           <a:s>\'MG/ML\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"15\">\n                           <a:s>\'mg/mL\'</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    else </a:s>\n                     <a:s r=\"21\">\n                        <a:s r=\"19\">\n                           <a:s r=\"17\">\n                              <a:s>\'unknown{\'</a:s>\n                           </a:s>\n                           <a:s> + </a:s>\n                           <a:s r=\"18\">\n                              <a:s>unit</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> + </a:s>\n                        <a:s r=\"20\">\n                           <a:s>\'}\'</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> // Should probably be an error\n  end</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"22\" xsi:type=\"Case\">\n            <comparand localId=\"4\" name=\"unit\" xsi:type=\"OperandRef\"/>\n            <caseItem localId=\"7\">\n               <when localId=\"5\" valueType=\"t:String\" value=\"MG\" xsi:type=\"Literal\"/>\n               <then localId=\"6\" valueType=\"t:String\" value=\"mg\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"10\">\n               <when localId=\"8\" valueType=\"t:String\" value=\"MG/ACTUAT\" xsi:type=\"Literal\"/>\n               <then localId=\"9\" valueType=\"t:String\" value=\"mg/{actuat}\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"13\">\n               <when localId=\"11\" valueType=\"t:String\" value=\"MG/HR\" xsi:type=\"Literal\"/>\n               <then localId=\"12\" valueType=\"t:String\" value=\"mg/h\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"16\">\n               <when localId=\"14\" valueType=\"t:String\" value=\"MG/ML\" xsi:type=\"Literal\"/>\n               <then localId=\"15\" valueType=\"t:String\" value=\"mg/mL\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <else localId=\"21\" xsi:type=\"Concatenate\">\n               <operand localId=\"19\" xsi:type=\"Concatenate\">\n                  <operand localId=\"17\" valueType=\"t:String\" value=\"unknown{\" xsi:type=\"Literal\"/>\n                  <operand localId=\"18\" name=\"unit\" xsi:type=\"OperandRef\"/>\n               </operand>\n               <operand localId=\"20\" valueType=\"t:String\" value=\"}\" xsi:type=\"Literal\"/>\n            </else>\n         </expression>\n         <operand name=\"unit\">\n            <operandTypeSpecifier localId=\"3\" name=\"t:String\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"106\" name=\"ToDaily\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"106\">\n               <a:s>define function ToDaily(frequency </a:s>\n               <a:s r=\"24\">\n                  <a:s>Integer</a:s>\n               </a:s>\n               <a:s>, period </a:s>\n               <a:s r=\"25\">\n                  <a:s>System.Quantity</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"105\">\n                  <a:s r=\"105\">\n                     <a:s>case </a:s>\n                     <a:s r=\"27\">\n                        <a:s r=\"26\">\n                           <a:s>period</a:s>\n                        </a:s>\n                        <a:s>.</a:s>\n                        <a:s r=\"27\">\n                           <a:s>unit</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"35\">\n                        <a:s>when </a:s>\n                        <a:s r=\"28\">\n                           <a:s>\'h\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"34\">\n                           <a:s r=\"29\">\n                              <a:s>frequency</a:s>\n                           </a:s>\n                           <a:s> * </a:s>\n                           <a:s r=\"33\">\n                              <a:s>(</a:s>\n                              <a:s r=\"33\">\n                                 <a:s r=\"30\">24.0 / </a:s>\n                                 <a:s r=\"32\">\n                                    <a:s r=\"31\">\n                                       <a:s>period</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"32\">\n                                       <a:s>value</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"45\">\n                        <a:s>when </a:s>\n                        <a:s r=\"36\">\n                           <a:s>\'min\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"44\">\n                           <a:s r=\"42\">\n                              <a:s r=\"37\">\n                                 <a:s>frequency</a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"41\">\n                                 <a:s>(</a:s>\n                                 <a:s r=\"41\">\n                                    <a:s r=\"38\">24.0 / </a:s>\n                                    <a:s r=\"40\">\n                                       <a:s r=\"39\">\n                                          <a:s>period</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"40\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> * 60</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"57\">\n                        <a:s>when </a:s>\n                        <a:s r=\"46\">\n                           <a:s>\'s\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"56\">\n                           <a:s r=\"54\">\n                              <a:s r=\"52\">\n                                 <a:s r=\"47\">\n                                    <a:s>frequency</a:s>\n                                 </a:s>\n                                 <a:s> * </a:s>\n                                 <a:s r=\"51\">\n                                    <a:s>(</a:s>\n                                    <a:s r=\"51\">\n                                       <a:s r=\"48\">24.0 / </a:s>\n                                       <a:s r=\"50\">\n                                          <a:s r=\"49\">\n                                             <a:s>period</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"50\">\n                                             <a:s>value</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>)</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> * 60</a:s>\n                           </a:s>\n                           <a:s> * 60</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"67\">\n                        <a:s>when </a:s>\n                        <a:s r=\"58\">\n                           <a:s>\'d\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"66\">\n                           <a:s r=\"64\">\n                              <a:s r=\"59\">\n                                 <a:s>frequency</a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"63\">\n                                 <a:s>(</a:s>\n                                 <a:s r=\"63\">\n                                    <a:s r=\"60\">24.0 / </a:s>\n                                    <a:s r=\"62\">\n                                       <a:s r=\"61\">\n                                          <a:s>period</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"62\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> / 24</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"79\">\n                        <a:s>when </a:s>\n                        <a:s r=\"68\">\n                           <a:s>\'wk\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"78\">\n                           <a:s r=\"74\">\n                              <a:s r=\"69\">\n                                 <a:s>frequency</a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"73\">\n                                 <a:s>(</a:s>\n                                 <a:s r=\"73\">\n                                    <a:s r=\"70\">24.0 / </a:s>\n                                    <a:s r=\"72\">\n                                       <a:s r=\"71\">\n                                          <a:s>period</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"72\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> / </a:s>\n                           <a:s r=\"77\">\n                              <a:s>(</a:s>\n                              <a:s r=\"77\">\n                                 <a:s r=\"75\">24 * 7</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"91\">\n                        <a:s>when </a:s>\n                        <a:s r=\"80\">\n                           <a:s>\'mo\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"90\">\n                           <a:s r=\"86\">\n                              <a:s r=\"81\">\n                                 <a:s>frequency</a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"85\">\n                                 <a:s>(</a:s>\n                                 <a:s r=\"85\">\n                                    <a:s r=\"82\">24.0 / </a:s>\n                                    <a:s r=\"84\">\n                                       <a:s r=\"83\">\n                                          <a:s>period</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"84\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> / </a:s>\n                           <a:s r=\"89\">\n                              <a:s>(</a:s>\n                              <a:s r=\"89\">\n                                 <a:s r=\"87\">24 * 30</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> // assuming 30 days in month\n    </a:s>\n                     <a:s r=\"103\">\n                        <a:s>when </a:s>\n                        <a:s r=\"92\">\n                           <a:s>\'a\'</a:s>\n                        </a:s>\n                        <a:s> then </a:s>\n                        <a:s r=\"102\">\n                           <a:s r=\"98\">\n                              <a:s r=\"93\">\n                                 <a:s>frequency</a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"97\">\n                                 <a:s>(</a:s>\n                                 <a:s r=\"97\">\n                                    <a:s r=\"94\">24.0 / </a:s>\n                                    <a:s r=\"96\">\n                                       <a:s r=\"95\">\n                                          <a:s>period</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"96\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> / </a:s>\n                           <a:s r=\"101\">\n                              <a:s>(</a:s>\n                              <a:s r=\"101\">\n                                 <a:s r=\"99\">24 * 365</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> // assuming 365 days in year\n    else null\n  end</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"105\" xsi:type=\"Case\">\n            <comparand localId=\"27\" path=\"unit\" xsi:type=\"Property\">\n               <source localId=\"26\" name=\"period\" xsi:type=\"OperandRef\"/>\n            </comparand>\n            <caseItem localId=\"35\">\n               <when localId=\"28\" valueType=\"t:String\" value=\"h\" xsi:type=\"Literal\"/>\n               <then localId=\"34\" xsi:type=\"Multiply\">\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"29\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                  </operand>\n                  <operand localId=\"33\" xsi:type=\"Divide\">\n                     <operand localId=\"30\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                     <operand localId=\"32\" path=\"value\" xsi:type=\"Property\">\n                        <source localId=\"31\" name=\"period\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"45\">\n               <when localId=\"36\" valueType=\"t:String\" value=\"min\" xsi:type=\"Literal\"/>\n               <then localId=\"44\" xsi:type=\"Multiply\">\n                  <operand localId=\"42\" xsi:type=\"Multiply\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"37\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"41\" xsi:type=\"Divide\">\n                        <operand localId=\"38\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                        <operand localId=\"40\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"39\" name=\"period\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"43\" valueType=\"t:Integer\" value=\"60\" xsi:type=\"Literal\"/>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"57\">\n               <when localId=\"46\" valueType=\"t:String\" value=\"s\" xsi:type=\"Literal\"/>\n               <then localId=\"56\" xsi:type=\"Multiply\">\n                  <operand localId=\"54\" xsi:type=\"Multiply\">\n                     <operand localId=\"52\" xsi:type=\"Multiply\">\n                        <operand xsi:type=\"ToDecimal\">\n                           <operand localId=\"47\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                        <operand localId=\"51\" xsi:type=\"Divide\">\n                           <operand localId=\"48\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                           <operand localId=\"50\" path=\"value\" xsi:type=\"Property\">\n                              <source localId=\"49\" name=\"period\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                     </operand>\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"53\" valueType=\"t:Integer\" value=\"60\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"55\" valueType=\"t:Integer\" value=\"60\" xsi:type=\"Literal\"/>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"67\">\n               <when localId=\"58\" valueType=\"t:String\" value=\"d\" xsi:type=\"Literal\"/>\n               <then localId=\"66\" xsi:type=\"Divide\">\n                  <operand localId=\"64\" xsi:type=\"Multiply\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"59\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"63\" xsi:type=\"Divide\">\n                        <operand localId=\"60\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                        <operand localId=\"62\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"61\" name=\"period\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"65\" valueType=\"t:Integer\" value=\"24\" xsi:type=\"Literal\"/>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"79\">\n               <when localId=\"68\" valueType=\"t:String\" value=\"wk\" xsi:type=\"Literal\"/>\n               <then localId=\"78\" xsi:type=\"Divide\">\n                  <operand localId=\"74\" xsi:type=\"Multiply\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"69\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"73\" xsi:type=\"Divide\">\n                        <operand localId=\"70\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                        <operand localId=\"72\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"71\" name=\"period\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"77\" xsi:type=\"Multiply\">\n                        <operand localId=\"75\" valueType=\"t:Integer\" value=\"24\" xsi:type=\"Literal\"/>\n                        <operand localId=\"76\" valueType=\"t:Integer\" value=\"7\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"91\">\n               <when localId=\"80\" valueType=\"t:String\" value=\"mo\" xsi:type=\"Literal\"/>\n               <then localId=\"90\" xsi:type=\"Divide\">\n                  <operand localId=\"86\" xsi:type=\"Multiply\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"81\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"85\" xsi:type=\"Divide\">\n                        <operand localId=\"82\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                        <operand localId=\"84\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"83\" name=\"period\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"89\" xsi:type=\"Multiply\">\n                        <operand localId=\"87\" valueType=\"t:Integer\" value=\"24\" xsi:type=\"Literal\"/>\n                        <operand localId=\"88\" valueType=\"t:Integer\" value=\"30\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"103\">\n               <when localId=\"92\" valueType=\"t:String\" value=\"a\" xsi:type=\"Literal\"/>\n               <then localId=\"102\" xsi:type=\"Divide\">\n                  <operand localId=\"98\" xsi:type=\"Multiply\">\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"93\" name=\"frequency\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"97\" xsi:type=\"Divide\">\n                        <operand localId=\"94\" valueType=\"t:Decimal\" value=\"24.0\" xsi:type=\"Literal\"/>\n                        <operand localId=\"96\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"95\" name=\"period\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                  </operand>\n                  <operand xsi:type=\"ToDecimal\">\n                     <operand localId=\"101\" xsi:type=\"Multiply\">\n                        <operand localId=\"99\" valueType=\"t:Integer\" value=\"24\" xsi:type=\"Literal\"/>\n                        <operand localId=\"100\" valueType=\"t:Integer\" value=\"365\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </operand>\n               </then>\n            </caseItem>\n            <else asType=\"t:Decimal\" xsi:type=\"As\">\n               <operand localId=\"104\" xsi:type=\"Null\"/>\n               <asTypeSpecifier name=\"t:Decimal\" xsi:type=\"NamedTypeSpecifier\"/>\n            </else>\n         </expression>\n         <operand name=\"frequency\">\n            <operandTypeSpecifier localId=\"24\" name=\"t:Integer\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"period\">\n            <operandTypeSpecifier localId=\"25\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"113\" name=\"IsPatch\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"113\">\n               <a:s>define function IsPatch(doseFormCode </a:s>\n               <a:s r=\"107\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"112\">\n                  <a:s r=\"112\">\n                     <a:s r=\"110\">\n                        <a:s>ToInteger(</a:s>\n                        <a:s r=\"109\">\n                           <a:s r=\"108\">\n                              <a:s>doseFormCode</a:s>\n                           </a:s>\n                           <a:s>.</a:s>\n                           <a:s r=\"109\">\n                              <a:s>code</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>)</a:s>\n                     </a:s>\n                     <a:s> = 316987</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"112\" xsi:type=\"Equal\">\n            <operand localId=\"110\" xsi:type=\"ToInteger\">\n               <operand localId=\"109\" path=\"code\" xsi:type=\"Property\">\n                  <source localId=\"108\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n               </operand>\n            </operand>\n            <operand localId=\"111\" valueType=\"t:Integer\" value=\"316987\" xsi:type=\"Literal\"/>\n         </expression>\n         <operand name=\"doseFormCode\">\n            <operandTypeSpecifier localId=\"107\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"321\" name=\"GetConversionFactor\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"321\">\n               <a:s>define function GetConversionFactor(ingredientCode </a:s>\n               <a:s r=\"114\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>, dailyDose </a:s>\n               <a:s r=\"115\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>, doseFormCode </a:s>\n               <a:s r=\"116\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"320\">\n                  <a:s r=\"320\">\n                     <a:s>case </a:s>\n                     <a:s r=\"119\">\n                        <a:s>ToInteger(</a:s>\n                        <a:s r=\"118\">\n                           <a:s r=\"117\">\n                              <a:s>ingredientCode</a:s>\n                           </a:s>\n                           <a:s>.</a:s>\n                           <a:s r=\"118\">\n                              <a:s>code</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>)</a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"122\">\n                        <a:s>when 161 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tAcetaminophen\n    </a:s>\n                     <a:s r=\"125\">\n                        <a:s>when 1191 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tAspirin\n    </a:s>\n                     <a:s r=\"128\">\n                        <a:s>when 1223 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tAtropine\n    </a:s>\n                     <a:s r=\"131\">\n                        <a:s>when 1767 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tBrompheniramine\n    </a:s>\n                     <a:s r=\"142\">\n                        <a:s>when 1819 then </a:s>\n                        <a:s r=\"141\">\n                           <a:s>( //\tBuprenorphine\n      </a:s>\n                           <a:s r=\"141\">\n                              <a:s>case \n        </a:s>\n                              <a:s r=\"139\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"137\">\n                                    <a:s r=\"135\">\n                                       <a:s>ToInteger(</a:s>\n                                       <a:s r=\"134\">\n                                          <a:s r=\"133\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"134\">\n                                             <a:s>code</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                    <a:s> = 316987</a:s>\n                                 </a:s>\n                                 <a:s> then 12.6</a:s>\n                              </a:s>\n                              <a:s> // Transdermal system\n        else 30 // Tablet or Film (or Film in MCG)\n      end</a:s>\n                           </a:s>\n                           <a:s>\n    )</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> \n    </a:s>\n                     <a:s r=\"145\">\n                        <a:s>when 1841 then 7</a:s>\n                     </a:s>\n                     <a:s> //\tButorphanol\n    </a:s>\n                     <a:s r=\"148\">\n                        <a:s>when 1886 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tCaffeine\n    </a:s>\n                     <a:s r=\"151\">\n                        <a:s>when 2101 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tCarisoprodol\n    </a:s>\n                     <a:s r=\"154\">\n                        <a:s>when 2354 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tchlorcyclizine\n    </a:s>\n                     <a:s r=\"157\">\n                        <a:s>when 2400 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tChlorpheniramine\n    </a:s>\n                     <a:s r=\"160\">\n                        <a:s>when 2670 then 0.15</a:s>\n                     </a:s>\n                     <a:s> //\tCodeine\n    </a:s>\n                     <a:s r=\"163\">\n                        <a:s>when 3423 then 4</a:s>\n                     </a:s>\n                     <a:s> //\tHydromorphone\n    </a:s>\n                     <a:s r=\"166\">\n                        <a:s>when 3498 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tDiphenhydramine\n    </a:s>\n                     <a:s r=\"200\">\n                        <a:s>when 4337 then </a:s>\n                        <a:s r=\"199\">\n                           <a:s>( //\tFentanyl\n      </a:s>\n                           <a:s r=\"199\">\n                              <a:s>case\n        </a:s>\n                              <a:s r=\"177\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"175\">\n                                    <a:s r=\"170\">\n                                       <a:s>ToInteger(</a:s>\n                                       <a:s r=\"169\">\n                                          <a:s r=\"168\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"169\">\n                                             <a:s>code</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                    <a:s> in </a:s>\n                                    <a:s r=\"174\">\n                                       <a:s>{ 970789, 317007, 316992 }</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> then 0.13</a:s>\n                              </a:s>\n                              <a:s> // Buccal Tablet, Sublingual Tablet, Oral Lozenge\n        </a:s>\n                              <a:s r=\"184\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"182\">\n                                    <a:s r=\"180\">\n                                       <a:s>ToInteger(</a:s>\n                                       <a:s r=\"179\">\n                                          <a:s r=\"178\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"179\">\n                                             <a:s>code</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                    <a:s> = 346163</a:s>\n                                 </a:s>\n                                 <a:s> then 0.18</a:s>\n                              </a:s>\n                              <a:s> // Buccal Film\n        </a:s>\n                              <a:s r=\"193\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"191\">\n                                    <a:s r=\"187\">\n                                       <a:s>ToInteger(</a:s>\n                                       <a:s r=\"186\">\n                                          <a:s r=\"185\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"186\">\n                                             <a:s>code</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                    <a:s> in </a:s>\n                                    <a:s r=\"190\">\n                                       <a:s>{ 126542, 346163 }</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> then 0.16</a:s>\n                              </a:s>\n                              <a:s> // Nasal Spray, Mucosal Spray\n        </a:s>\n                              <a:s r=\"197\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"195\">\n                                    <a:s>IsPatch(</a:s>\n                                    <a:s r=\"194\">\n                                       <a:s>doseFormCode</a:s>\n                                    </a:s>\n                                    <a:s>)</a:s>\n                                 </a:s>\n                                 <a:s> then 7.2</a:s>\n                              </a:s>\n                              <a:s> // Transdermal system\n        else 1000 // Really ought to be an error because it represents a previously unencountered dose form....\n      end</a:s>\n                           </a:s>\n                           <a:s>\n    )</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"203\">\n                        <a:s>when 5032 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tGuaifenesin\n    </a:s>\n                     <a:s r=\"206\">\n                        <a:s>when 5489 then 1</a:s>\n                     </a:s>\n                     <a:s> //\tHydrocodone\n    </a:s>\n                     <a:s r=\"209\">\n                        <a:s>when 5640 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tIbuprofen\n    </a:s>\n                     <a:s r=\"212\">\n                        <a:s>when 6102 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tKaolin\n    </a:s>\n                     <a:s r=\"215\">\n                        <a:s>when 6378 then 11</a:s>\n                     </a:s>\n                     <a:s> //\tLevorphanol (NOTE: Given as Levorphanol tartrate in the CDC conversion table)\n    </a:s>\n                     <a:s r=\"218\">\n                        <a:s>when 6754 then 0.1</a:s>\n                     </a:s>\n                     <a:s> //\tMeperidine\n    </a:s>\n                     <a:s r=\"249\">\n                        <a:s>when 6813 then </a:s>\n                        <a:s r=\"248\">\n                           <a:s>( //\tMethadone\n      </a:s>\n                           <a:s r=\"248\">\n                              <a:s>case\n        </a:s>\n                              <a:s r=\"226\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"224\">\n                                    <a:s r=\"221\">\n                                       <a:s r=\"220\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"221\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> between 1 and 20</a:s>\n                                 </a:s>\n                                 <a:s> then 4</a:s>\n                              </a:s>\n                              <a:s>\n        </a:s>\n                              <a:s r=\"233\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"231\">\n                                    <a:s r=\"228\">\n                                       <a:s r=\"227\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"228\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> between 21 and 40</a:s>\n                                 </a:s>\n                                 <a:s> then 8</a:s>\n                              </a:s>\n                              <a:s>\n        </a:s>\n                              <a:s r=\"240\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"238\">\n                                    <a:s r=\"235\">\n                                       <a:s r=\"234\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"235\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> between 41 and 60</a:s>\n                                 </a:s>\n                                 <a:s> then 10</a:s>\n                              </a:s>\n                              <a:s>\n        </a:s>\n                              <a:s r=\"246\">\n                                 <a:s>when </a:s>\n                                 <a:s r=\"244\">\n                                    <a:s r=\"242\">\n                                       <a:s r=\"241\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"242\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> >= 61</a:s>\n                                 </a:s>\n                                 <a:s> then 12</a:s>\n                              </a:s>\n                              <a:s>\n        else 1000 // Really ought to be an error because it represents an unexpected dose range...\n      end</a:s>\n                           </a:s>\n                           <a:s>\n    )</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"252\">\n                        <a:s>when 7052 then 1</a:s>\n                     </a:s>\n                     <a:s> //\tMorphine\n    </a:s>\n                     <a:s r=\"255\">\n                        <a:s>when 7242 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tNaloxone\n    </a:s>\n                     <a:s r=\"258\">\n                        <a:s>when 7243 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tNaltrexone\n    </a:s>\n                     <a:s r=\"261\">\n                        <a:s>when 7804 then 1.5</a:s>\n                     </a:s>\n                     <a:s> //\tOxycodone\n    </a:s>\n                     <a:s r=\"264\">\n                        <a:s>when 7814 then 3</a:s>\n                     </a:s>\n                     <a:s> //\tOxymorphone\n    </a:s>\n                     <a:s r=\"267\">\n                        <a:s>when 8001 then 0.37</a:s>\n                     </a:s>\n                     <a:s> //\tPentazocine\n    </a:s>\n                     <a:s r=\"270\">\n                        <a:s>when 8163 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tPhenylephrine\n    </a:s>\n                     <a:s r=\"273\">\n                        <a:s>when 8175 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tPhenylpropanolamine\n    </a:s>\n                     <a:s r=\"276\">\n                        <a:s>when 8745 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tPromethazine\n    </a:s>\n                     <a:s r=\"279\">\n                        <a:s>when 8896 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tPseudoephedrine\n    </a:s>\n                     <a:s r=\"282\">\n                        <a:s>when 9009 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tPyrilamine\n    </a:s>\n                     <a:s r=\"285\">\n                        <a:s>when 10689 then 0.1</a:s>\n                     </a:s>\n                     <a:s> //\tTramadol\n    </a:s>\n                     <a:s r=\"288\">\n                        <a:s>when 10849 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tTriprolidine\n    </a:s>\n                     <a:s r=\"291\">\n                        <a:s>when 19759 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tbromodiphenhydramine\n    </a:s>\n                     <a:s r=\"294\">\n                        <a:s>when 19860 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tbutalbital\n    </a:s>\n                     <a:s r=\"297\">\n                        <a:s>when 22696 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tdexbrompheniramine\n    </a:s>\n                     <a:s r=\"300\">\n                        <a:s>when 22697 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tdexchlorpheniramine\n    </a:s>\n                     <a:s r=\"303\">\n                        <a:s>when 23088 then 0.25</a:s>\n                     </a:s>\n                     <a:s> //\tdihydrocodeine\n    </a:s>\n                     <a:s r=\"306\">\n                        <a:s>when 27084 then 0</a:s>\n                     </a:s>\n                     <a:s> //\thomatropine\n    </a:s>\n                     <a:s r=\"309\">\n                        <a:s>when 35780 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tropivacaine\n    </a:s>\n                     <a:s r=\"312\">\n                        <a:s>when 237005 then 8</a:s>\n                     </a:s>\n                     <a:s> //\tLevomethadyl (NOTE: given as Levomethadyl acetate in the CDC conversion table)\n    </a:s>\n                     <a:s r=\"315\">\n                        <a:s>when 636827 then 0</a:s>\n                     </a:s>\n                     <a:s> //\tguaiacolsulfonate\n    </a:s>\n                     <a:s r=\"318\">\n                        <a:s>when 787390 then 0.4</a:s>\n                     </a:s>\n                     <a:s> //\ttapentadol\n    else 0\n  end</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"320\" xsi:type=\"Case\">\n            <comparand localId=\"119\" xsi:type=\"ToInteger\">\n               <operand localId=\"118\" path=\"code\" xsi:type=\"Property\">\n                  <source localId=\"117\" name=\"ingredientCode\" xsi:type=\"OperandRef\"/>\n               </operand>\n            </comparand>\n            <caseItem localId=\"122\">\n               <when localId=\"120\" valueType=\"t:Integer\" value=\"161\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"121\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"125\">\n               <when localId=\"123\" valueType=\"t:Integer\" value=\"1191\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"124\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"128\">\n               <when localId=\"126\" valueType=\"t:Integer\" value=\"1223\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"127\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"131\">\n               <when localId=\"129\" valueType=\"t:Integer\" value=\"1767\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"130\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"142\">\n               <when localId=\"132\" valueType=\"t:Integer\" value=\"1819\" xsi:type=\"Literal\"/>\n               <then localId=\"141\" xsi:type=\"Case\">\n                  <caseItem localId=\"139\">\n                     <when localId=\"137\" xsi:type=\"Equal\">\n                        <operand localId=\"135\" xsi:type=\"ToInteger\">\n                           <operand localId=\"134\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"133\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"136\" valueType=\"t:Integer\" value=\"316987\" xsi:type=\"Literal\"/>\n                     </when>\n                     <then localId=\"138\" valueType=\"t:Decimal\" value=\"12.6\" xsi:type=\"Literal\"/>\n                  </caseItem>\n                  <else xsi:type=\"ToDecimal\">\n                     <operand localId=\"140\" valueType=\"t:Integer\" value=\"30\" xsi:type=\"Literal\"/>\n                  </else>\n               </then>\n            </caseItem>\n            <caseItem localId=\"145\">\n               <when localId=\"143\" valueType=\"t:Integer\" value=\"1841\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"144\" valueType=\"t:Integer\" value=\"7\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"148\">\n               <when localId=\"146\" valueType=\"t:Integer\" value=\"1886\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"147\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"151\">\n               <when localId=\"149\" valueType=\"t:Integer\" value=\"2101\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"150\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"154\">\n               <when localId=\"152\" valueType=\"t:Integer\" value=\"2354\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"153\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"157\">\n               <when localId=\"155\" valueType=\"t:Integer\" value=\"2400\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"156\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"160\">\n               <when localId=\"158\" valueType=\"t:Integer\" value=\"2670\" xsi:type=\"Literal\"/>\n               <then localId=\"159\" valueType=\"t:Decimal\" value=\"0.15\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"163\">\n               <when localId=\"161\" valueType=\"t:Integer\" value=\"3423\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"162\" valueType=\"t:Integer\" value=\"4\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"166\">\n               <when localId=\"164\" valueType=\"t:Integer\" value=\"3498\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"165\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"200\">\n               <when localId=\"167\" valueType=\"t:Integer\" value=\"4337\" xsi:type=\"Literal\"/>\n               <then localId=\"199\" xsi:type=\"Case\">\n                  <caseItem localId=\"177\">\n                     <when localId=\"175\" xsi:type=\"In\">\n                        <operand localId=\"170\" xsi:type=\"ToInteger\">\n                           <operand localId=\"169\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"168\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"174\" xsi:type=\"List\">\n                           <element localId=\"171\" valueType=\"t:Integer\" value=\"970789\" xsi:type=\"Literal\"/>\n                           <element localId=\"172\" valueType=\"t:Integer\" value=\"317007\" xsi:type=\"Literal\"/>\n                           <element localId=\"173\" valueType=\"t:Integer\" value=\"316992\" xsi:type=\"Literal\"/>\n                        </operand>\n                     </when>\n                     <then localId=\"176\" valueType=\"t:Decimal\" value=\"0.13\" xsi:type=\"Literal\"/>\n                  </caseItem>\n                  <caseItem localId=\"184\">\n                     <when localId=\"182\" xsi:type=\"Equal\">\n                        <operand localId=\"180\" xsi:type=\"ToInteger\">\n                           <operand localId=\"179\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"178\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"181\" valueType=\"t:Integer\" value=\"346163\" xsi:type=\"Literal\"/>\n                     </when>\n                     <then localId=\"183\" valueType=\"t:Decimal\" value=\"0.18\" xsi:type=\"Literal\"/>\n                  </caseItem>\n                  <caseItem localId=\"193\">\n                     <when localId=\"191\" xsi:type=\"In\">\n                        <operand localId=\"187\" xsi:type=\"ToInteger\">\n                           <operand localId=\"186\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"185\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"190\" xsi:type=\"List\">\n                           <element localId=\"188\" valueType=\"t:Integer\" value=\"126542\" xsi:type=\"Literal\"/>\n                           <element localId=\"189\" valueType=\"t:Integer\" value=\"346163\" xsi:type=\"Literal\"/>\n                        </operand>\n                     </when>\n                     <then localId=\"192\" valueType=\"t:Decimal\" value=\"0.16\" xsi:type=\"Literal\"/>\n                  </caseItem>\n                  <caseItem localId=\"197\">\n                     <when localId=\"195\" name=\"IsPatch\" xsi:type=\"FunctionRef\">\n                        <operand localId=\"194\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n                     </when>\n                     <then localId=\"196\" valueType=\"t:Decimal\" value=\"7.2\" xsi:type=\"Literal\"/>\n                  </caseItem>\n                  <else xsi:type=\"ToDecimal\">\n                     <operand localId=\"198\" valueType=\"t:Integer\" value=\"1000\" xsi:type=\"Literal\"/>\n                  </else>\n               </then>\n            </caseItem>\n            <caseItem localId=\"203\">\n               <when localId=\"201\" valueType=\"t:Integer\" value=\"5032\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"202\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"206\">\n               <when localId=\"204\" valueType=\"t:Integer\" value=\"5489\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"205\" valueType=\"t:Integer\" value=\"1\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"209\">\n               <when localId=\"207\" valueType=\"t:Integer\" value=\"5640\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"208\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"212\">\n               <when localId=\"210\" valueType=\"t:Integer\" value=\"6102\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"211\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"215\">\n               <when localId=\"213\" valueType=\"t:Integer\" value=\"6378\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"214\" valueType=\"t:Integer\" value=\"11\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"218\">\n               <when localId=\"216\" valueType=\"t:Integer\" value=\"6754\" xsi:type=\"Literal\"/>\n               <then localId=\"217\" valueType=\"t:Decimal\" value=\"0.1\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"249\">\n               <when localId=\"219\" valueType=\"t:Integer\" value=\"6813\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"248\" xsi:type=\"Case\">\n                     <caseItem localId=\"226\">\n                        <when localId=\"224\" xsi:type=\"And\">\n                           <operand xsi:type=\"GreaterOrEqual\">\n                              <operand localId=\"221\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"220\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"222\" valueType=\"t:Integer\" value=\"1\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                           <operand xsi:type=\"LessOrEqual\">\n                              <operand localId=\"221\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"220\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"223\" valueType=\"t:Integer\" value=\"20\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                        </when>\n                        <then localId=\"225\" valueType=\"t:Integer\" value=\"4\" xsi:type=\"Literal\"/>\n                     </caseItem>\n                     <caseItem localId=\"233\">\n                        <when localId=\"231\" xsi:type=\"And\">\n                           <operand xsi:type=\"GreaterOrEqual\">\n                              <operand localId=\"228\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"227\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"229\" valueType=\"t:Integer\" value=\"21\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                           <operand xsi:type=\"LessOrEqual\">\n                              <operand localId=\"228\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"227\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"230\" valueType=\"t:Integer\" value=\"40\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                        </when>\n                        <then localId=\"232\" valueType=\"t:Integer\" value=\"8\" xsi:type=\"Literal\"/>\n                     </caseItem>\n                     <caseItem localId=\"240\">\n                        <when localId=\"238\" xsi:type=\"And\">\n                           <operand xsi:type=\"GreaterOrEqual\">\n                              <operand localId=\"235\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"234\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"236\" valueType=\"t:Integer\" value=\"41\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                           <operand xsi:type=\"LessOrEqual\">\n                              <operand localId=\"235\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"234\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                              <operand xsi:type=\"ToDecimal\">\n                                 <operand localId=\"237\" valueType=\"t:Integer\" value=\"60\" xsi:type=\"Literal\"/>\n                              </operand>\n                           </operand>\n                        </when>\n                        <then localId=\"239\" valueType=\"t:Integer\" value=\"10\" xsi:type=\"Literal\"/>\n                     </caseItem>\n                     <caseItem localId=\"246\">\n                        <when localId=\"244\" xsi:type=\"GreaterOrEqual\">\n                           <operand localId=\"242\" path=\"value\" xsi:type=\"Property\">\n                              <source localId=\"241\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                           <operand xsi:type=\"ToDecimal\">\n                              <operand localId=\"243\" valueType=\"t:Integer\" value=\"61\" xsi:type=\"Literal\"/>\n                           </operand>\n                        </when>\n                        <then localId=\"245\" valueType=\"t:Integer\" value=\"12\" xsi:type=\"Literal\"/>\n                     </caseItem>\n                     <else localId=\"247\" valueType=\"t:Integer\" value=\"1000\" xsi:type=\"Literal\"/>\n                  </operand>\n               </then>\n            </caseItem>\n            <caseItem localId=\"252\">\n               <when localId=\"250\" valueType=\"t:Integer\" value=\"7052\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"251\" valueType=\"t:Integer\" value=\"1\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"255\">\n               <when localId=\"253\" valueType=\"t:Integer\" value=\"7242\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"254\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"258\">\n               <when localId=\"256\" valueType=\"t:Integer\" value=\"7243\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"257\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"261\">\n               <when localId=\"259\" valueType=\"t:Integer\" value=\"7804\" xsi:type=\"Literal\"/>\n               <then localId=\"260\" valueType=\"t:Decimal\" value=\"1.5\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"264\">\n               <when localId=\"262\" valueType=\"t:Integer\" value=\"7814\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"263\" valueType=\"t:Integer\" value=\"3\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"267\">\n               <when localId=\"265\" valueType=\"t:Integer\" value=\"8001\" xsi:type=\"Literal\"/>\n               <then localId=\"266\" valueType=\"t:Decimal\" value=\"0.37\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"270\">\n               <when localId=\"268\" valueType=\"t:Integer\" value=\"8163\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"269\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"273\">\n               <when localId=\"271\" valueType=\"t:Integer\" value=\"8175\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"272\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"276\">\n               <when localId=\"274\" valueType=\"t:Integer\" value=\"8745\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"275\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"279\">\n               <when localId=\"277\" valueType=\"t:Integer\" value=\"8896\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"278\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"282\">\n               <when localId=\"280\" valueType=\"t:Integer\" value=\"9009\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"281\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"285\">\n               <when localId=\"283\" valueType=\"t:Integer\" value=\"10689\" xsi:type=\"Literal\"/>\n               <then localId=\"284\" valueType=\"t:Decimal\" value=\"0.1\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"288\">\n               <when localId=\"286\" valueType=\"t:Integer\" value=\"10849\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"287\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"291\">\n               <when localId=\"289\" valueType=\"t:Integer\" value=\"19759\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"290\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"294\">\n               <when localId=\"292\" valueType=\"t:Integer\" value=\"19860\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"293\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"297\">\n               <when localId=\"295\" valueType=\"t:Integer\" value=\"22696\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"296\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"300\">\n               <when localId=\"298\" valueType=\"t:Integer\" value=\"22697\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"299\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"303\">\n               <when localId=\"301\" valueType=\"t:Integer\" value=\"23088\" xsi:type=\"Literal\"/>\n               <then localId=\"302\" valueType=\"t:Decimal\" value=\"0.25\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <caseItem localId=\"306\">\n               <when localId=\"304\" valueType=\"t:Integer\" value=\"27084\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"305\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"309\">\n               <when localId=\"307\" valueType=\"t:Integer\" value=\"35780\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"308\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"312\">\n               <when localId=\"310\" valueType=\"t:Integer\" value=\"237005\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"311\" valueType=\"t:Integer\" value=\"8\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"315\">\n               <when localId=\"313\" valueType=\"t:Integer\" value=\"636827\" xsi:type=\"Literal\"/>\n               <then xsi:type=\"ToDecimal\">\n                  <operand localId=\"314\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n               </then>\n            </caseItem>\n            <caseItem localId=\"318\">\n               <when localId=\"316\" valueType=\"t:Integer\" value=\"787390\" xsi:type=\"Literal\"/>\n               <then localId=\"317\" valueType=\"t:Decimal\" value=\"0.4\" xsi:type=\"Literal\"/>\n            </caseItem>\n            <else xsi:type=\"ToDecimal\">\n               <operand localId=\"319\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n            </else>\n         </expression>\n         <operand name=\"ingredientCode\">\n            <operandTypeSpecifier localId=\"114\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"dailyDose\">\n            <operandTypeSpecifier localId=\"115\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseFormCode\">\n            <operandTypeSpecifier localId=\"116\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"347\" name=\"EnsureMicrogramQuantity\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"347\">\n               <a:s>define function EnsureMicrogramQuantity(strength </a:s>\n               <a:s r=\"322\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"346\">\n                  <a:s r=\"346\">\n                     <a:s>if </a:s>\n                     <a:s r=\"333\">\n                        <a:s r=\"326\">\n                           <a:s r=\"324\">\n                              <a:s r=\"323\">\n                                 <a:s>strength</a:s>\n                              </a:s>\n                              <a:s>.</a:s>\n                              <a:s r=\"324\">\n                                 <a:s>value</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> &lt; 0.1</a:s>\n                        </a:s>\n                        <a:s> and </a:s>\n                        <a:s r=\"332\">\n                           <a:s>(</a:s>\n                           <a:s r=\"332\">\n                              <a:s r=\"330\">\n                                 <a:s>PositionOf(</a:s>\n                                 <a:s r=\"327\">\n                                    <a:s>\'mg\'</a:s>\n                                 </a:s>\n                                 <a:s>, </a:s>\n                                 <a:s r=\"329\">\n                                    <a:s r=\"328\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"329\">\n                                       <a:s>unit</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                              <a:s> = 0</a:s>\n                           </a:s>\n                           <a:s>)</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> then\n    </a:s>\n                     <a:s r=\"344\">\n                        <a:s>Quantity {\n      </a:s>\n                        <a:s>\n                           <a:s>value: </a:s>\n                           <a:s r=\"337\">\n                              <a:s r=\"335\">\n                                 <a:s r=\"334\">\n                                    <a:s>strength</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"335\">\n                                    <a:s>value</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> * 1000</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>,\n      </a:s>\n                        <a:s>\n                           <a:s>unit: </a:s>\n                           <a:s r=\"343\">\n                              <a:s r=\"338\">\n                                 <a:s>\'mcg\'</a:s>\n                              </a:s>\n                              <a:s> + </a:s>\n                              <a:s r=\"342\">\n                                 <a:s>Substring(</a:s>\n                                 <a:s r=\"340\">\n                                    <a:s r=\"339\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"340\">\n                                       <a:s>unit</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>, 2)</a:s>\n                              </a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>\n    }</a:s>\n                     </a:s>\n                     <a:s>\n  else\n    </a:s>\n                     <a:s r=\"345\">\n                        <a:s>strength</a:s>\n                     </a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"346\" xsi:type=\"If\">\n            <condition asType=\"t:Boolean\" xsi:type=\"As\">\n               <operand localId=\"333\" xsi:type=\"And\">\n                  <operand localId=\"326\" xsi:type=\"Less\">\n                     <operand localId=\"324\" path=\"value\" xsi:type=\"Property\">\n                        <source localId=\"323\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"325\" valueType=\"t:Decimal\" value=\"0.1\" xsi:type=\"Literal\"/>\n                  </operand>\n                  <operand localId=\"332\" xsi:type=\"Equal\">\n                     <operand localId=\"330\" xsi:type=\"PositionOf\">\n                        <pattern localId=\"327\" valueType=\"t:String\" value=\"mg\" xsi:type=\"Literal\"/>\n                        <string localId=\"329\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"328\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </string>\n                     </operand>\n                     <operand localId=\"331\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                  </operand>\n               </operand>\n               <asTypeSpecifier name=\"t:Boolean\" xsi:type=\"NamedTypeSpecifier\"/>\n            </condition>\n            <then localId=\"344\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n               <element name=\"value\">\n                  <value localId=\"337\" xsi:type=\"Multiply\">\n                     <operand localId=\"335\" path=\"value\" xsi:type=\"Property\">\n                        <source localId=\"334\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand xsi:type=\"ToDecimal\">\n                        <operand localId=\"336\" valueType=\"t:Integer\" value=\"1000\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </value>\n               </element>\n               <element name=\"unit\">\n                  <value localId=\"343\" xsi:type=\"Concatenate\">\n                     <operand localId=\"338\" valueType=\"t:String\" value=\"mcg\" xsi:type=\"Literal\"/>\n                     <operand localId=\"342\" xsi:type=\"Substring\">\n                        <stringToSub localId=\"340\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"339\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </stringToSub>\n                        <startIndex localId=\"341\" valueType=\"t:Integer\" value=\"2\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </value>\n               </element>\n            </then>\n            <else localId=\"345\" name=\"strength\" xsi:type=\"OperandRef\"/>\n         </expression>\n         <operand name=\"strength\">\n            <operandTypeSpecifier localId=\"322\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"401\" name=\"GetIngredients\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"401\">\n               <a:s>define function GetIngredients(rxNormCode </a:s>\n               <a:s r=\"348\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"400\">\n                  <a:s r=\"400\">\n                     <a:s>\n                        <a:s r=\"365\">\n                           <a:s r=\"364\">\n                              <a:s>(\n    </a:s>\n                              <a:s r=\"364\">\n                                 <a:s>\n                                    <a:s r=\"350\">\n                                       <a:s r=\"349\">\n                                          <a:s r=\"349\">\n                                             <a:s>[MED_SCDC_FOR_DRUG: DRUG_RXCUI in </a:s>\n                                             <a:s>\n                                                <a:s>rxNormCode</a:s>\n                                             </a:s>\n                                             <a:s>]</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> SD</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>\n      </a:s>\n                                 <a:s r=\"352\">\n                                    <a:s>where </a:s>\n                                    <a:s r=\"352\">\n                                       <a:s>exists </a:s>\n                                       <a:s r=\"351\">\n                                          <a:s>(</a:s>\n                                          <a:s r=\"351\">\n                                             <a:s>[MED_DRUG_VALUE_SET: DRUG_RXCUI in </a:s>\n                                             <a:s>\n                                                <a:s>SD.DRUG_RXCUI</a:s>\n                                             </a:s>\n                                             <a:s>]</a:s>\n                                          </a:s>\n                                          <a:s>)</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>\n      </a:s>\n                                 <a:s r=\"363\">\n                                    <a:s>return </a:s>\n                                    <a:s r=\"362\">\n                                       <a:s>{\n        </a:s>\n                                       <a:s>\n                                          <a:s>rxNormCode: </a:s>\n                                          <a:s r=\"353\">\n                                             <a:s>rxNormCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>,\n        </a:s>\n                                       <a:s>\n                                          <a:s>component: </a:s>\n                                          <a:s r=\"355\">\n                                             <a:s>SingletonFrom(</a:s>\n                                             <a:s r=\"354\">\n                                                <a:s>[MED_SCDC: SCDC_RXCUI in </a:s>\n                                                <a:s>\n                                                   <a:s>SD.SCDC_RXCUI</a:s>\n                                                </a:s>\n                                                <a:s>]</a:s>\n                                             </a:s>\n                                             <a:s>)</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>,\n        </a:s>\n                                       <a:s>\n                                          <a:s>ingredientCode: </a:s>\n                                          <a:s r=\"358\">\n                                             <a:s r=\"357\">\n                                                <a:s>SingletonFrom(</a:s>\n                                                <a:s r=\"356\">\n                                                   <a:s>[MED_SCDC: SCDC_RXCUI in </a:s>\n                                                   <a:s>\n                                                      <a:s>SD.SCDC_RXCUI</a:s>\n                                                   </a:s>\n                                                   <a:s>]</a:s>\n                                                </a:s>\n                                                <a:s>)</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"358\">\n                                                <a:s>INGREDIENT_RXCUI</a:s>\n                                             </a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>,\n        </a:s>\n                                       <a:s>\n                                          <a:s>doseFormCode: </a:s>\n                                          <a:s r=\"361\">\n                                             <a:s r=\"360\">\n                                                <a:s>SingletonFrom(</a:s>\n                                                <a:s r=\"359\">\n                                                   <a:s>[MED_DRUG: DRUG_RXCUI in </a:s>\n                                                   <a:s>\n                                                      <a:s>SD.DRUG_RXCUI</a:s>\n                                                   </a:s>\n                                                   <a:s>]</a:s>\n                                                </a:s>\n                                                <a:s>)</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"361\">\n                                                <a:s>DOSE_FORM_RXCUI</a:s>\n                                             </a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> // Could potentially look this up only once...\n      }</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>\n  )</a:s>\n                           </a:s>\n                           <a:s> C</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s>\n                        <a:s>let\n      </a:s>\n                        <a:s r=\"368\">\n                           <a:s>ingredient: </a:s>\n                           <a:s r=\"367\">\n                              <a:s>SingletonFrom(</a:s>\n                              <a:s r=\"366\">\n                                 <a:s>[MED_INGREDIENT: INGREDIENT_RXCUI in </a:s>\n                                 <a:s>\n                                    <a:s>C.ingredientCode</a:s>\n                                 </a:s>\n                                 <a:s>]</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>,\n      </a:s>\n                        <a:s r=\"371\">\n                           <a:s>doseForm: </a:s>\n                           <a:s r=\"370\">\n                              <a:s>SingletonFrom(</a:s>\n                              <a:s r=\"369\">\n                                 <a:s>[MED_DOSE_FORM: DOSE_FORM_RXCUI in </a:s>\n                                 <a:s>\n                                    <a:s>C.doseFormCode</a:s>\n                                 </a:s>\n                                 <a:s>]</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"379\">\n                        <a:s>where </a:s>\n                        <a:s r=\"379\">\n                           <a:s>exists </a:s>\n                           <a:s r=\"378\">\n                              <a:s>(\n      </a:s>\n                              <a:s r=\"378\">\n                                 <a:s>\n                                    <a:s r=\"373\">\n                                       <a:s r=\"372\">\n                                          <a:s r=\"372\">\n                                             <a:s>[MED_INGREDIENT_TYPE: INGREDIENT_RXCUI in </a:s>\n                                             <a:s>\n                                                <a:s>C.ingredientCode</a:s>\n                                             </a:s>\n                                             <a:s>]</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> IT</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>\n        </a:s>\n                                 <a:s r=\"377\">\n                                    <a:s>where </a:s>\n                                    <a:s r=\"377\">\n                                       <a:s r=\"375\">\n                                          <a:s r=\"374\">\n                                             <a:s>IT</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"375\">\n                                             <a:s>INGREDIENT_TYPE</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> = </a:s>\n                                       <a:s r=\"376\">\n                                          <a:s>\'Opioid_NonSurgical\'</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>\n    )</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n    </a:s>\n                     <a:s r=\"399\">\n                        <a:s>return </a:s>\n                        <a:s r=\"398\">\n                           <a:s>{\n      </a:s>\n                           <a:s>\n                              <a:s>rxNormCode: </a:s>\n                              <a:s r=\"380\">\n                                 <a:s>rxNormCode</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>,\n      </a:s>\n                           <a:s>\n                              <a:s>doseFormCode: </a:s>\n                              <a:s r=\"382\">\n                                 <a:s r=\"381\">\n                                    <a:s>C</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"382\">\n                                    <a:s>doseFormCode</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>,\n      </a:s>\n                           <a:s>\n                              <a:s>doseFormName: </a:s>\n                              <a:s r=\"384\">\n                                 <a:s r=\"383\">\n                                    <a:s>doseForm</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"384\">\n                                    <a:s>DOSE_FORM_NAME</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>,\n      </a:s>\n                           <a:s>\n                              <a:s>ingredientCode: </a:s>\n                              <a:s r=\"386\">\n                                 <a:s r=\"385\">\n                                    <a:s>C</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"386\">\n                                    <a:s>ingredientCode</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>,\n      </a:s>\n                           <a:s>\n                              <a:s>ingredientName: </a:s>\n                              <a:s r=\"388\">\n                                 <a:s r=\"387\">\n                                    <a:s>ingredient</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"388\">\n                                    <a:s>INGREDIENT_NAME</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>,\n      </a:s>\n                           <a:s>\n                              <a:s>strength:\n        </a:s>\n                              <a:s r=\"397\">\n                                 <a:s>EnsureMicrogramQuantity(\n          </a:s>\n                                 <a:s r=\"396\">\n                                    <a:s>Quantity {\n            </a:s>\n                                    <a:s>\n                                       <a:s>value: </a:s>\n                                       <a:s r=\"391\">\n                                          <a:s r=\"390\">\n                                             <a:s r=\"389\">\n                                                <a:s>C</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"390\">\n                                                <a:s>component</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"391\">\n                                             <a:s>STRENGTH_VALUE</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>unit: </a:s>\n                                       <a:s r=\"395\">\n                                          <a:s>ToUCUM(</a:s>\n                                          <a:s r=\"394\">\n                                             <a:s r=\"393\">\n                                                <a:s r=\"392\">\n                                                   <a:s>C</a:s>\n                                                </a:s>\n                                                <a:s>.</a:s>\n                                                <a:s r=\"393\">\n                                                   <a:s>component</a:s>\n                                                </a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"394\">\n                                                <a:s>STRENGTH_UNIT</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>)</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>\n          }</a:s>\n                                 </a:s>\n                                 <a:s>\n        )</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>\n    }</a:s>\n                        </a:s>\n                     </a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"400\" xsi:type=\"Query\">\n            <source localId=\"365\" alias=\"C\">\n               <expression localId=\"364\" xsi:type=\"Query\">\n                  <source localId=\"350\" alias=\"SD\">\n                     <expression localId=\"349\" xmlns:ns0=\"http://org.opencds/opioid-cds\" dataType=\"ns0:MED_SCDC_FOR_DRUG\" codeProperty=\"DRUG_RXCUI\" xsi:type=\"Retrieve\">\n                        <codes xsi:type=\"ToList\">\n                           <operand name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n                        </codes>\n                     </expression>\n                  </source>\n                  <where localId=\"352\" xsi:type=\"Exists\">\n                     <operand localId=\"351\" xmlns:ns1=\"http://org.opencds/opioid-cds\" dataType=\"ns1:MED_DRUG_VALUE_SET\" codeProperty=\"DRUG_RXCUI\" xsi:type=\"Retrieve\">\n                        <codes xsi:type=\"ToList\">\n                           <operand path=\"DRUG_RXCUI\" scope=\"SD\" xsi:type=\"Property\"/>\n                        </codes>\n                     </operand>\n                  </where>\n                  <return localId=\"363\">\n                     <expression localId=\"362\" xsi:type=\"Tuple\">\n                        <element name=\"rxNormCode\">\n                           <value localId=\"353\" name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n                        </element>\n                        <element name=\"component\">\n                           <value localId=\"355\" xsi:type=\"SingletonFrom\">\n                              <operand localId=\"354\" xmlns:ns2=\"http://org.opencds/opioid-cds\" dataType=\"ns2:MED_SCDC\" codeProperty=\"SCDC_RXCUI\" xsi:type=\"Retrieve\">\n                                 <codes xsi:type=\"ToList\">\n                                    <operand path=\"SCDC_RXCUI\" scope=\"SD\" xsi:type=\"Property\"/>\n                                 </codes>\n                              </operand>\n                           </value>\n                        </element>\n                        <element name=\"ingredientCode\">\n                           <value localId=\"358\" path=\"INGREDIENT_RXCUI\" xsi:type=\"Property\">\n                              <source localId=\"357\" xsi:type=\"SingletonFrom\">\n                                 <operand localId=\"356\" xmlns:ns3=\"http://org.opencds/opioid-cds\" dataType=\"ns3:MED_SCDC\" codeProperty=\"SCDC_RXCUI\" xsi:type=\"Retrieve\">\n                                    <codes xsi:type=\"ToList\">\n                                       <operand path=\"SCDC_RXCUI\" scope=\"SD\" xsi:type=\"Property\"/>\n                                    </codes>\n                                 </operand>\n                              </source>\n                           </value>\n                        </element>\n                        <element name=\"doseFormCode\">\n                           <value localId=\"361\" path=\"DOSE_FORM_RXCUI\" xsi:type=\"Property\">\n                              <source localId=\"360\" xsi:type=\"SingletonFrom\">\n                                 <operand localId=\"359\" xmlns:ns4=\"http://org.opencds/opioid-cds\" dataType=\"ns4:MED_DRUG\" codeProperty=\"DRUG_RXCUI\" xsi:type=\"Retrieve\">\n                                    <codes xsi:type=\"ToList\">\n                                       <operand path=\"DRUG_RXCUI\" scope=\"SD\" xsi:type=\"Property\"/>\n                                    </codes>\n                                 </operand>\n                              </source>\n                           </value>\n                        </element>\n                     </expression>\n                  </return>\n               </expression>\n            </source>\n            <let localId=\"368\" identifier=\"ingredient\">\n               <expression localId=\"367\" xsi:type=\"SingletonFrom\">\n                  <operand localId=\"366\" xmlns:ns5=\"http://org.opencds/opioid-cds\" dataType=\"ns5:MED_INGREDIENT\" codeProperty=\"INGREDIENT_RXCUI\" xsi:type=\"Retrieve\">\n                     <codes xsi:type=\"ToList\">\n                        <operand path=\"ingredientCode\" scope=\"C\" xsi:type=\"Property\"/>\n                     </codes>\n                  </operand>\n               </expression>\n            </let>\n            <let localId=\"371\" identifier=\"doseForm\">\n               <expression localId=\"370\" xsi:type=\"SingletonFrom\">\n                  <operand localId=\"369\" xmlns:ns6=\"http://org.opencds/opioid-cds\" dataType=\"ns6:MED_DOSE_FORM\" codeProperty=\"DOSE_FORM_RXCUI\" xsi:type=\"Retrieve\">\n                     <codes xsi:type=\"ToList\">\n                        <operand path=\"doseFormCode\" scope=\"C\" xsi:type=\"Property\"/>\n                     </codes>\n                  </operand>\n               </expression>\n            </let>\n            <where localId=\"379\" xsi:type=\"Exists\">\n               <operand localId=\"378\" xsi:type=\"Query\">\n                  <source localId=\"373\" alias=\"IT\">\n                     <expression localId=\"372\" xmlns:ns7=\"http://org.opencds/opioid-cds\" dataType=\"ns7:MED_INGREDIENT_TYPE\" codeProperty=\"INGREDIENT_RXCUI\" xsi:type=\"Retrieve\">\n                        <codes xsi:type=\"ToList\">\n                           <operand path=\"ingredientCode\" scope=\"C\" xsi:type=\"Property\"/>\n                        </codes>\n                     </expression>\n                  </source>\n                  <where localId=\"377\" xsi:type=\"Equal\">\n                     <operand localId=\"375\" path=\"INGREDIENT_TYPE\" scope=\"IT\" xsi:type=\"Property\"/>\n                     <operand localId=\"376\" valueType=\"t:String\" value=\"Opioid_NonSurgical\" xsi:type=\"Literal\"/>\n                  </where>\n               </operand>\n            </where>\n            <return localId=\"399\">\n               <expression localId=\"398\" xsi:type=\"Tuple\">\n                  <element name=\"rxNormCode\">\n                     <value localId=\"380\" name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n                  </element>\n                  <element name=\"doseFormCode\">\n                     <value localId=\"382\" path=\"doseFormCode\" scope=\"C\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"doseFormName\">\n                     <value localId=\"384\" path=\"DOSE_FORM_NAME\" xsi:type=\"Property\">\n                        <source localId=\"383\" name=\"doseForm\" xsi:type=\"QueryLetRef\"/>\n                     </value>\n                  </element>\n                  <element name=\"ingredientCode\">\n                     <value localId=\"386\" path=\"ingredientCode\" scope=\"C\" xsi:type=\"Property\"/>\n                  </element>\n                  <element name=\"ingredientName\">\n                     <value localId=\"388\" path=\"INGREDIENT_NAME\" xsi:type=\"Property\">\n                        <source localId=\"387\" name=\"ingredient\" xsi:type=\"QueryLetRef\"/>\n                     </value>\n                  </element>\n                  <element name=\"strength\">\n                     <value localId=\"397\" name=\"EnsureMicrogramQuantity\" xsi:type=\"FunctionRef\">\n                        <operand localId=\"396\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                           <element name=\"value\">\n                              <value localId=\"391\" path=\"STRENGTH_VALUE\" xsi:type=\"Property\">\n                                 <source localId=\"390\" path=\"component\" scope=\"C\" xsi:type=\"Property\"/>\n                              </value>\n                           </element>\n                           <element name=\"unit\">\n                              <value localId=\"395\" name=\"ToUCUM\" xsi:type=\"FunctionRef\">\n                                 <operand localId=\"394\" path=\"STRENGTH_UNIT\" xsi:type=\"Property\">\n                                    <source localId=\"393\" path=\"component\" scope=\"C\" xsi:type=\"Property\"/>\n                                 </operand>\n                              </value>\n                           </element>\n                        </operand>\n                     </value>\n                  </element>\n               </expression>\n            </return>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier localId=\"348\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"492\" name=\"GetDailyDose\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"492\">\n               <a:s>define function GetDailyDose(ingredientCode </a:s>\n               <a:s r=\"402\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>, strength </a:s>\n               <a:s r=\"403\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>, doseFormCode </a:s>\n               <a:s r=\"404\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>, doseQuantity </a:s>\n               <a:s r=\"405\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>, dosesPerDay </a:s>\n               <a:s r=\"406\">\n                  <a:s>Decimal</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"491\">\n                  <a:s r=\"491\">\n                     <a:s>case\n\t  // if patch --> daily dose = dose value (e.g, number patches with doseQuantity unit = &quot;patch&quot;) * per-hour strength\n    </a:s>\n                     <a:s r=\"428\">\n                        <a:s>when </a:s>\n                        <a:s r=\"408\">\n                           <a:s>IsPatch(</a:s>\n                           <a:s r=\"407\">\n                              <a:s>doseFormCode</a:s>\n                           </a:s>\n                           <a:s>)</a:s>\n                        </a:s>\n                        <a:s> then\n      // buprenorphine or fentanyl patch\n      </a:s>\n                        <a:s r=\"427\">\n                           <a:s>if </a:s>\n                           <a:s r=\"415\">\n                              <a:s r=\"411\">\n                                 <a:s>ToInteger(</a:s>\n                                 <a:s r=\"410\">\n                                    <a:s r=\"409\">\n                                       <a:s>ingredientCode</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"410\">\n                                       <a:s>code</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                              <a:s> in </a:s>\n                              <a:s r=\"414\">\n                                 <a:s>{ 1819, 4337 }</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> then\n        </a:s>\n                           <a:s r=\"425\">\n                              <a:s>Quantity { </a:s>\n                              <a:s>\n                                 <a:s>value: </a:s>\n                                 <a:s r=\"422\">\n                                    <a:s r=\"419\">\n                                       <a:s r=\"416\">\n                                          <a:s>dosesPerDay</a:s>\n                                       </a:s>\n                                       <a:s> * </a:s>\n                                       <a:s r=\"418\">\n                                          <a:s r=\"417\">\n                                             <a:s>doseQuantity</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"418\">\n                                             <a:s>value</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> * </a:s>\n                                    <a:s r=\"421\">\n                                       <a:s r=\"420\">\n                                          <a:s>strength</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"421\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>, </a:s>\n                              <a:s>\n                                 <a:s>unit: </a:s>\n                                 <a:s r=\"424\">\n                                    <a:s r=\"423\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"424\">\n                                       <a:s>unit</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> }</a:s>\n                           </a:s>\n                           <a:s>\n      else\n        null</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n\n    // if dose unit in actual mass units (mg or mcg -- when it\'s a single med) --> daily dose = numTimesPerDay * dose\n    </a:s>\n                     <a:s r=\"442\">\n                        <a:s>when </a:s>\n                        <a:s r=\"434\">\n                           <a:s r=\"430\">\n                              <a:s r=\"429\">\n                                 <a:s>doseQuantity</a:s>\n                              </a:s>\n                              <a:s>.</a:s>\n                              <a:s r=\"430\">\n                                 <a:s>unit</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> in </a:s>\n                           <a:s r=\"433\">\n                              <a:s>{ </a:s>\n                              <a:s r=\"431\">\n                                 <a:s>\'mg\'</a:s>\n                              </a:s>\n                              <a:s>, </a:s>\n                              <a:s r=\"432\">\n                                 <a:s>\'mcg\'</a:s>\n                              </a:s>\n                              <a:s> }</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> then\n      </a:s>\n                        <a:s r=\"441\">\n                           <a:s>Quantity { </a:s>\n                           <a:s>\n                              <a:s>value: </a:s>\n                              <a:s r=\"438\">\n                                 <a:s r=\"435\">\n                                    <a:s>dosesPerDay</a:s>\n                                 </a:s>\n                                 <a:s> * </a:s>\n                                 <a:s r=\"437\">\n                                    <a:s r=\"436\">\n                                       <a:s>doseQuantity</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"437\">\n                                       <a:s>value</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>, </a:s>\n                           <a:s>\n                              <a:s>unit: </a:s>\n                              <a:s r=\"440\">\n                                 <a:s r=\"439\">\n                                    <a:s>doseQuantity</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"440\">\n                                    <a:s>unit</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> }</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n\n    // if doseQuantity is in actual volume units (mL) --> daily dose = numTimesPerDay * dose * strength\n    </a:s>\n                     <a:s r=\"474\">\n                        <a:s>when </a:s>\n                        <a:s r=\"457\">\n                           <a:s r=\"446\">\n                              <a:s r=\"444\">\n                                 <a:s r=\"443\">\n                                    <a:s>doseQuantity</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"444\">\n                                    <a:s>unit</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> = </a:s>\n                              <a:s r=\"445\">\n                                 <a:s>\'mL\'</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> and </a:s>\n                           <a:s r=\"456\">\n                              <a:s>(</a:s>\n                              <a:s r=\"456\">\n                                 <a:s r=\"450\">\n                                    <a:s>PositionOf(</a:s>\n                                    <a:s r=\"447\">\n                                       <a:s>\'/mL\'</a:s>\n                                    </a:s>\n                                    <a:s>, </a:s>\n                                    <a:s r=\"449\">\n                                       <a:s r=\"448\">\n                                          <a:s>strength</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"449\">\n                                          <a:s>unit</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>)</a:s>\n                                 </a:s>\n                                 <a:s> = </a:s>\n                                 <a:s r=\"455\">\n                                    <a:s r=\"453\">\n                                       <a:s>Length(</a:s>\n                                       <a:s r=\"452\">\n                                          <a:s r=\"451\">\n                                             <a:s>strength</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"452\">\n                                             <a:s>unit</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                    <a:s> - 3</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> then\n      </a:s>\n                        <a:s r=\"473\">\n                           <a:s>Quantity { </a:s>\n                           <a:s>\n                              <a:s>value: </a:s>\n                              <a:s r=\"464\">\n                                 <a:s r=\"461\">\n                                    <a:s r=\"458\">\n                                       <a:s>dosesPerDay</a:s>\n                                    </a:s>\n                                    <a:s> * </a:s>\n                                    <a:s r=\"460\">\n                                       <a:s r=\"459\">\n                                          <a:s>doseQuantity</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"460\">\n                                          <a:s>value</a:s>\n                                       </a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> * </a:s>\n                                 <a:s r=\"463\">\n                                    <a:s r=\"462\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"463\">\n                                       <a:s>value</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>, </a:s>\n                           <a:s>\n                              <a:s>unit: </a:s>\n                              <a:s r=\"472\">\n                                 <a:s>Substring(</a:s>\n                                 <a:s r=\"466\">\n                                    <a:s r=\"465\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"466\">\n                                       <a:s>unit</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>, 0, </a:s>\n                                 <a:s r=\"471\">\n                                    <a:s>PositionOf(</a:s>\n                                    <a:s r=\"468\">\n                                       <a:s>\'/\'</a:s>\n                                    </a:s>\n                                    <a:s>, </a:s>\n                                    <a:s r=\"470\">\n                                       <a:s r=\"469\">\n                                          <a:s>strength</a:s>\n                                       </a:s>\n                                       <a:s>.</a:s>\n                                       <a:s r=\"470\">\n                                          <a:s>unit</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>)</a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> }</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n\n\t\t// if doseQuantity is not in actual units (e.g., 1 tab, 1 spray -- when it\'s a combo med with a unit of tablet, or it\'s mg/actuat) --> daily dose = numTimesPerDay * dose value * strength value\n    else\n      </a:s>\n                     <a:s r=\"490\">\n                        <a:s>Quantity { </a:s>\n                        <a:s>\n                           <a:s>value: </a:s>\n                           <a:s r=\"481\">\n                              <a:s r=\"478\">\n                                 <a:s r=\"475\">\n                                    <a:s>dosesPerDay</a:s>\n                                 </a:s>\n                                 <a:s> * </a:s>\n                                 <a:s r=\"477\">\n                                    <a:s r=\"476\">\n                                       <a:s>doseQuantity</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"477\">\n                                       <a:s>value</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> * </a:s>\n                              <a:s r=\"480\">\n                                 <a:s r=\"479\">\n                                    <a:s>strength</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"480\">\n                                    <a:s>value</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>, </a:s>\n                        <a:s>\n                           <a:s>unit: </a:s>\n                           <a:s r=\"489\">\n                              <a:s>Substring(</a:s>\n                              <a:s r=\"483\">\n                                 <a:s r=\"482\">\n                                    <a:s>strength</a:s>\n                                 </a:s>\n                                 <a:s>.</a:s>\n                                 <a:s r=\"483\">\n                                    <a:s>unit</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>, 0, </a:s>\n                              <a:s r=\"488\">\n                                 <a:s>PositionOf(</a:s>\n                                 <a:s r=\"485\">\n                                    <a:s>\'/\'</a:s>\n                                 </a:s>\n                                 <a:s>, </a:s>\n                                 <a:s r=\"487\">\n                                    <a:s r=\"486\">\n                                       <a:s>strength</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"487\">\n                                       <a:s>unit</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> }</a:s>\n                     </a:s>\n                     <a:s>\n  end</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"491\" xsi:type=\"Case\">\n            <caseItem localId=\"428\">\n               <when localId=\"408\" name=\"IsPatch\" xsi:type=\"FunctionRef\">\n                  <operand localId=\"407\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n               </when>\n               <then localId=\"427\" xsi:type=\"If\">\n                  <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                     <operand localId=\"415\" xsi:type=\"In\">\n                        <operand localId=\"411\" xsi:type=\"ToInteger\">\n                           <operand localId=\"410\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"409\" name=\"ingredientCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"414\" xsi:type=\"List\">\n                           <element localId=\"412\" valueType=\"t:Integer\" value=\"1819\" xsi:type=\"Literal\"/>\n                           <element localId=\"413\" valueType=\"t:Integer\" value=\"4337\" xsi:type=\"Literal\"/>\n                        </operand>\n                     </operand>\n                     <asTypeSpecifier name=\"t:Boolean\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </condition>\n                  <then localId=\"425\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                     <element name=\"value\">\n                        <value localId=\"422\" xsi:type=\"Multiply\">\n                           <operand localId=\"419\" xsi:type=\"Multiply\">\n                              <operand localId=\"416\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                              <operand localId=\"418\" path=\"value\" xsi:type=\"Property\">\n                                 <source localId=\"417\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                           </operand>\n                           <operand localId=\"421\" path=\"value\" xsi:type=\"Property\">\n                              <source localId=\"420\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </value>\n                     </element>\n                     <element name=\"unit\">\n                        <value localId=\"424\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"423\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </value>\n                     </element>\n                  </then>\n                  <else asType=\"t:Quantity\" xsi:type=\"As\">\n                     <operand localId=\"426\" xsi:type=\"Null\"/>\n                     <asTypeSpecifier name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </else>\n               </then>\n            </caseItem>\n            <caseItem localId=\"442\">\n               <when localId=\"434\" xsi:type=\"In\">\n                  <operand localId=\"430\" path=\"unit\" xsi:type=\"Property\">\n                     <source localId=\"429\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                  </operand>\n                  <operand localId=\"433\" xsi:type=\"List\">\n                     <element localId=\"431\" valueType=\"t:String\" value=\"mg\" xsi:type=\"Literal\"/>\n                     <element localId=\"432\" valueType=\"t:String\" value=\"mcg\" xsi:type=\"Literal\"/>\n                  </operand>\n               </when>\n               <then localId=\"441\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                  <element name=\"value\">\n                     <value localId=\"438\" xsi:type=\"Multiply\">\n                        <operand localId=\"435\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                        <operand localId=\"437\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"436\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </value>\n                  </element>\n                  <element name=\"unit\">\n                     <value localId=\"440\" path=\"unit\" xsi:type=\"Property\">\n                        <source localId=\"439\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                     </value>\n                  </element>\n               </then>\n            </caseItem>\n            <caseItem localId=\"474\">\n               <when localId=\"457\" xsi:type=\"And\">\n                  <operand localId=\"446\" xsi:type=\"Equal\">\n                     <operand localId=\"444\" path=\"unit\" xsi:type=\"Property\">\n                        <source localId=\"443\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                     <operand localId=\"445\" valueType=\"t:String\" value=\"mL\" xsi:type=\"Literal\"/>\n                  </operand>\n                  <operand localId=\"456\" xsi:type=\"Equal\">\n                     <operand localId=\"450\" xsi:type=\"PositionOf\">\n                        <pattern localId=\"447\" valueType=\"t:String\" value=\"/mL\" xsi:type=\"Literal\"/>\n                        <string localId=\"449\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"448\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </string>\n                     </operand>\n                     <operand localId=\"455\" xsi:type=\"Subtract\">\n                        <operand localId=\"453\" xsi:type=\"Length\">\n                           <operand localId=\"452\" path=\"unit\" xsi:type=\"Property\">\n                              <source localId=\"451\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"454\" valueType=\"t:Integer\" value=\"3\" xsi:type=\"Literal\"/>\n                     </operand>\n                  </operand>\n               </when>\n               <then localId=\"473\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                  <element name=\"value\">\n                     <value localId=\"464\" xsi:type=\"Multiply\">\n                        <operand localId=\"461\" xsi:type=\"Multiply\">\n                           <operand localId=\"458\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                           <operand localId=\"460\" path=\"value\" xsi:type=\"Property\">\n                              <source localId=\"459\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"463\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"462\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </value>\n                  </element>\n                  <element name=\"unit\">\n                     <value localId=\"472\" xsi:type=\"Substring\">\n                        <stringToSub localId=\"466\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"465\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </stringToSub>\n                        <startIndex localId=\"467\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                        <length localId=\"471\" xsi:type=\"PositionOf\">\n                           <pattern localId=\"468\" valueType=\"t:String\" value=\"/\" xsi:type=\"Literal\"/>\n                           <string localId=\"470\" path=\"unit\" xsi:type=\"Property\">\n                              <source localId=\"469\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                           </string>\n                        </length>\n                     </value>\n                  </element>\n               </then>\n            </caseItem>\n            <else localId=\"490\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n               <element name=\"value\">\n                  <value localId=\"481\" xsi:type=\"Multiply\">\n                     <operand localId=\"478\" xsi:type=\"Multiply\">\n                        <operand localId=\"475\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                        <operand localId=\"477\" path=\"value\" xsi:type=\"Property\">\n                           <source localId=\"476\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                     <operand localId=\"480\" path=\"value\" xsi:type=\"Property\">\n                        <source localId=\"479\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                  </value>\n               </element>\n               <element name=\"unit\">\n                  <value localId=\"489\" xsi:type=\"Substring\">\n                     <stringToSub localId=\"483\" path=\"unit\" xsi:type=\"Property\">\n                        <source localId=\"482\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                     </stringToSub>\n                     <startIndex localId=\"484\" valueType=\"t:Integer\" value=\"0\" xsi:type=\"Literal\"/>\n                     <length localId=\"488\" xsi:type=\"PositionOf\">\n                        <pattern localId=\"485\" valueType=\"t:String\" value=\"/\" xsi:type=\"Literal\"/>\n                        <string localId=\"487\" path=\"unit\" xsi:type=\"Property\">\n                           <source localId=\"486\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                        </string>\n                     </length>\n                  </value>\n               </element>\n            </else>\n         </expression>\n         <operand name=\"ingredientCode\">\n            <operandTypeSpecifier localId=\"402\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"strength\">\n            <operandTypeSpecifier localId=\"403\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseFormCode\">\n            <operandTypeSpecifier localId=\"404\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseQuantity\">\n            <operandTypeSpecifier localId=\"405\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"dosesPerDay\">\n            <operandTypeSpecifier localId=\"406\" name=\"t:Decimal\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"497\" name=\"GetMedicationName\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"497\">\n               <a:s>define function GetMedicationName(rxNormCode </a:s>\n               <a:s r=\"493\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"496\">\n                  <a:s r=\"496\">\n                     <a:s r=\"495\">\n                        <a:s>SingletonFrom(</a:s>\n                        <a:s r=\"494\">\n                           <a:s>[MED_DRUG: DRUG_RXCUI in </a:s>\n                           <a:s>\n                              <a:s>rxNormCode</a:s>\n                           </a:s>\n                           <a:s>]</a:s>\n                        </a:s>\n                        <a:s>)</a:s>\n                     </a:s>\n                     <a:s>.</a:s>\n                     <a:s r=\"496\">\n                        <a:s>DRUG_NAME</a:s>\n                     </a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"496\" path=\"DRUG_NAME\" xsi:type=\"Property\">\n            <source localId=\"495\" xsi:type=\"SingletonFrom\">\n               <operand localId=\"494\" xmlns:ns8=\"http://org.opencds/opioid-cds\" dataType=\"ns8:MED_DRUG\" codeProperty=\"DRUG_RXCUI\" xsi:type=\"Retrieve\">\n                  <codes xsi:type=\"ToList\">\n                     <operand name=\"rxNormCode\" xsi:type=\"OperandRef\"/>\n                  </codes>\n               </operand>\n            </source>\n         </expression>\n         <operand name=\"rxNormCode\">\n            <operandTypeSpecifier localId=\"493\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"588\" name=\"GetDailyDoseDescription\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"588\">\n               <a:s>define function GetDailyDoseDescription(ingredientCode </a:s>\n               <a:s r=\"498\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>, ingredientName </a:s>\n               <a:s r=\"499\">\n                  <a:s>String</a:s>\n               </a:s>\n               <a:s>, strength </a:s>\n               <a:s r=\"500\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>, doseFormCode </a:s>\n               <a:s r=\"501\">\n                  <a:s>Code</a:s>\n               </a:s>\n               <a:s>, doseFormName </a:s>\n               <a:s r=\"502\">\n                  <a:s>String</a:s>\n               </a:s>\n               <a:s>, doseQuantity </a:s>\n               <a:s r=\"503\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>, dosesPerDay </a:s>\n               <a:s r=\"504\">\n                  <a:s>Decimal</a:s>\n               </a:s>\n               <a:s>, dailyDose </a:s>\n               <a:s r=\"505\">\n                  <a:s>Quantity</a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"587\">\n                  <a:s r=\"587\">\n                     <a:s>case\n    // if patch\n    </a:s>\n                     <a:s r=\"534\">\n                        <a:s>when </a:s>\n                        <a:s r=\"507\">\n                           <a:s>IsPatch(</a:s>\n                           <a:s r=\"506\">\n                              <a:s>doseFormCode</a:s>\n                           </a:s>\n                           <a:s>)</a:s>\n                        </a:s>\n                        <a:s> then\n      // buprenorphine or fentanyl patch\n      </a:s>\n                        <a:s r=\"533\">\n                           <a:s>if </a:s>\n                           <a:s r=\"514\">\n                              <a:s r=\"510\">\n                                 <a:s>ToInteger(</a:s>\n                                 <a:s r=\"509\">\n                                    <a:s r=\"508\">\n                                       <a:s>ingredientCode</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"509\">\n                                       <a:s>code</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                              <a:s> in </a:s>\n                              <a:s r=\"513\">\n                                 <a:s>{ 1819, 4337 }</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> then\n        </a:s>\n                           <a:s r=\"531\">\n                              <a:s r=\"528\">\n                                 <a:s r=\"526\">\n                                    <a:s r=\"523\">\n                                       <a:s r=\"521\">\n                                          <a:s r=\"517\">\n                                             <a:s r=\"515\">\n                                                <a:s>ingredientName</a:s>\n                                             </a:s>\n                                             <a:s> + </a:s>\n                                             <a:s r=\"516\">\n                                                <a:s>\' patch: \'</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s> + </a:s>\n                                          <a:s r=\"520\">\n                                             <a:s>ToString(</a:s>\n                                             <a:s r=\"519\">\n                                                <a:s r=\"518\">\n                                                   <a:s>doseQuantity</a:s>\n                                                </a:s>\n                                                <a:s>.</a:s>\n                                                <a:s r=\"519\">\n                                                   <a:s>value</a:s>\n                                                </a:s>\n                                             </a:s>\n                                             <a:s>)</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> + </a:s>\n                                       <a:s r=\"522\">\n                                          <a:s>\' * \'</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> + </a:s>\n                                    <a:s r=\"525\">\n                                       <a:s>ToString(</a:s>\n                                       <a:s r=\"524\">\n                                          <a:s>strength</a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> + </a:s>\n                                 <a:s r=\"527\">\n                                    <a:s>\' = \'</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> + </a:s>\n                              <a:s r=\"530\">\n                                 <a:s>ToString(</a:s>\n                                 <a:s r=\"529\">\n                                    <a:s>dailyDose</a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s>\n      else\n        null</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n\n    // if dose unit in actual mass units (mg or mcg -- when it\'s a single med)\n    </a:s>\n                     <a:s r=\"561\">\n                        <a:s>when </a:s>\n                        <a:s r=\"540\">\n                           <a:s r=\"536\">\n                              <a:s r=\"535\">\n                                 <a:s>doseQuantity</a:s>\n                              </a:s>\n                              <a:s>.</a:s>\n                              <a:s r=\"536\">\n                                 <a:s>unit</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> in </a:s>\n                           <a:s r=\"539\">\n                              <a:s>{ </a:s>\n                              <a:s r=\"537\">\n                                 <a:s>\'mg\'</a:s>\n                              </a:s>\n                              <a:s>, </a:s>\n                              <a:s r=\"538\">\n                                 <a:s>\'mcg\'</a:s>\n                              </a:s>\n                              <a:s> }</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> then\n      </a:s>\n                        <a:s r=\"560\">\n                           <a:s r=\"557\">\n                              <a:s r=\"555\">\n                                 <a:s r=\"552\">\n                                    <a:s r=\"550\">\n                                       <a:s r=\"547\">\n                                          <a:s r=\"545\">\n                                             <a:s r=\"543\">\n                                                <a:s r=\"541\">\n                                                   <a:s>ingredientName</a:s>\n                                                </a:s>\n                                                <a:s> + </a:s>\n                                                <a:s r=\"542\">\n                                                   <a:s>\' \'</a:s>\n                                                </a:s>\n                                             </a:s>\n                                             <a:s> + </a:s>\n                                             <a:s r=\"544\">\n                                                <a:s>doseFormName</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s> + </a:s>\n                                          <a:s r=\"546\">\n                                             <a:s>\': \'</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> + </a:s>\n                                       <a:s r=\"549\">\n                                          <a:s>ToString(</a:s>\n                                          <a:s r=\"548\">\n                                             <a:s>dosesPerDay</a:s>\n                                          </a:s>\n                                          <a:s>)</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> + </a:s>\n                                    <a:s r=\"551\">\n                                       <a:s>\'/d * \'</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> + </a:s>\n                                 <a:s r=\"554\">\n                                    <a:s>ToString(</a:s>\n                                    <a:s r=\"553\">\n                                       <a:s>doseQuantity</a:s>\n                                    </a:s>\n                                    <a:s>)</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> + </a:s>\n                              <a:s r=\"556\">\n                                 <a:s>\' = \'</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> + </a:s>\n                           <a:s r=\"559\">\n                              <a:s>ToString(</a:s>\n                              <a:s r=\"558\">\n                                 <a:s>dailyDose</a:s>\n                              </a:s>\n                              <a:s>)</a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n\n    // if doseQuantity in actual volume units (mL) or not in actual units (e.g. 1 tab, 1 spray)\n    else\n      </a:s>\n                     <a:s r=\"586\">\n                        <a:s r=\"583\">\n                           <a:s r=\"581\">\n                              <a:s r=\"578\">\n                                 <a:s r=\"576\">\n                                    <a:s r=\"573\">\n                                       <a:s r=\"571\">\n                                          <a:s r=\"568\">\n                                             <a:s r=\"566\">\n                                                <a:s r=\"564\">\n                                                   <a:s r=\"562\">\n                                                      <a:s>ingredientName</a:s>\n                                                   </a:s>\n                                                   <a:s> + </a:s>\n                                                   <a:s r=\"563\">\n                                                      <a:s>\' \'</a:s>\n                                                   </a:s>\n                                                </a:s>\n                                                <a:s> + </a:s>\n                                                <a:s r=\"565\">\n                                                   <a:s>doseFormName</a:s>\n                                                </a:s>\n                                             </a:s>\n                                             <a:s> + </a:s>\n                                             <a:s r=\"567\">\n                                                <a:s>\': \'</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s> + </a:s>\n                                          <a:s r=\"570\">\n                                             <a:s>ToString(</a:s>\n                                             <a:s r=\"569\">\n                                                <a:s>dosesPerDay</a:s>\n                                             </a:s>\n                                             <a:s>)</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s> + </a:s>\n                                       <a:s r=\"572\">\n                                          <a:s>\'/d * \'</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> + </a:s>\n                                    <a:s r=\"575\">\n                                       <a:s>ToString(</a:s>\n                                       <a:s r=\"574\">\n                                          <a:s>doseQuantity</a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s> + </a:s>\n                                 <a:s r=\"577\">\n                                    <a:s>\' * \'</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> + </a:s>\n                              <a:s r=\"580\">\n                                 <a:s>ToString(</a:s>\n                                 <a:s r=\"579\">\n                                    <a:s>strength</a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                           <a:s> + </a:s>\n                           <a:s r=\"582\">\n                              <a:s>\' = \'</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s> + </a:s>\n                        <a:s r=\"585\">\n                           <a:s>ToString(</a:s>\n                           <a:s r=\"584\">\n                              <a:s>dailyDose</a:s>\n                           </a:s>\n                           <a:s>)</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n  end</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"587\" xsi:type=\"Case\">\n            <caseItem localId=\"534\">\n               <when localId=\"507\" name=\"IsPatch\" xsi:type=\"FunctionRef\">\n                  <operand localId=\"506\" name=\"doseFormCode\" xsi:type=\"OperandRef\"/>\n               </when>\n               <then localId=\"533\" xsi:type=\"If\">\n                  <condition asType=\"t:Boolean\" xsi:type=\"As\">\n                     <operand localId=\"514\" xsi:type=\"In\">\n                        <operand localId=\"510\" xsi:type=\"ToInteger\">\n                           <operand localId=\"509\" path=\"code\" xsi:type=\"Property\">\n                              <source localId=\"508\" name=\"ingredientCode\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"513\" xsi:type=\"List\">\n                           <element localId=\"511\" valueType=\"t:Integer\" value=\"1819\" xsi:type=\"Literal\"/>\n                           <element localId=\"512\" valueType=\"t:Integer\" value=\"4337\" xsi:type=\"Literal\"/>\n                        </operand>\n                     </operand>\n                     <asTypeSpecifier name=\"t:Boolean\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </condition>\n                  <then localId=\"531\" xsi:type=\"Concatenate\">\n                     <operand localId=\"528\" xsi:type=\"Concatenate\">\n                        <operand localId=\"526\" xsi:type=\"Concatenate\">\n                           <operand localId=\"523\" xsi:type=\"Concatenate\">\n                              <operand localId=\"521\" xsi:type=\"Concatenate\">\n                                 <operand localId=\"517\" xsi:type=\"Concatenate\">\n                                    <operand localId=\"515\" name=\"ingredientName\" xsi:type=\"OperandRef\"/>\n                                    <operand localId=\"516\" valueType=\"t:String\" value=\" patch: \" xsi:type=\"Literal\"/>\n                                 </operand>\n                                 <operand localId=\"520\" xsi:type=\"ToString\">\n                                    <operand localId=\"519\" path=\"value\" xsi:type=\"Property\">\n                                       <source localId=\"518\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                                    </operand>\n                                 </operand>\n                              </operand>\n                              <operand localId=\"522\" valueType=\"t:String\" value=\" * \" xsi:type=\"Literal\"/>\n                           </operand>\n                           <operand localId=\"525\" xsi:type=\"ToString\">\n                              <operand localId=\"524\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"527\" valueType=\"t:String\" value=\" = \" xsi:type=\"Literal\"/>\n                     </operand>\n                     <operand localId=\"530\" xsi:type=\"ToString\">\n                        <operand localId=\"529\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                  </then>\n                  <else asType=\"t:String\" xsi:type=\"As\">\n                     <operand localId=\"532\" xsi:type=\"Null\"/>\n                     <asTypeSpecifier name=\"t:String\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </else>\n               </then>\n            </caseItem>\n            <caseItem localId=\"561\">\n               <when localId=\"540\" xsi:type=\"In\">\n                  <operand localId=\"536\" path=\"unit\" xsi:type=\"Property\">\n                     <source localId=\"535\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                  </operand>\n                  <operand localId=\"539\" xsi:type=\"List\">\n                     <element localId=\"537\" valueType=\"t:String\" value=\"mg\" xsi:type=\"Literal\"/>\n                     <element localId=\"538\" valueType=\"t:String\" value=\"mcg\" xsi:type=\"Literal\"/>\n                  </operand>\n               </when>\n               <then localId=\"560\" xsi:type=\"Concatenate\">\n                  <operand localId=\"557\" xsi:type=\"Concatenate\">\n                     <operand localId=\"555\" xsi:type=\"Concatenate\">\n                        <operand localId=\"552\" xsi:type=\"Concatenate\">\n                           <operand localId=\"550\" xsi:type=\"Concatenate\">\n                              <operand localId=\"547\" xsi:type=\"Concatenate\">\n                                 <operand localId=\"545\" xsi:type=\"Concatenate\">\n                                    <operand localId=\"543\" xsi:type=\"Concatenate\">\n                                       <operand localId=\"541\" name=\"ingredientName\" xsi:type=\"OperandRef\"/>\n                                       <operand localId=\"542\" valueType=\"t:String\" value=\" \" xsi:type=\"Literal\"/>\n                                    </operand>\n                                    <operand localId=\"544\" name=\"doseFormName\" xsi:type=\"OperandRef\"/>\n                                 </operand>\n                                 <operand localId=\"546\" valueType=\"t:String\" value=\": \" xsi:type=\"Literal\"/>\n                              </operand>\n                              <operand localId=\"549\" xsi:type=\"ToString\">\n                                 <operand localId=\"548\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                              </operand>\n                           </operand>\n                           <operand localId=\"551\" valueType=\"t:String\" value=\"/d * \" xsi:type=\"Literal\"/>\n                        </operand>\n                        <operand localId=\"554\" xsi:type=\"ToString\">\n                           <operand localId=\"553\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                        </operand>\n                     </operand>\n                     <operand localId=\"556\" valueType=\"t:String\" value=\" = \" xsi:type=\"Literal\"/>\n                  </operand>\n                  <operand localId=\"559\" xsi:type=\"ToString\">\n                     <operand localId=\"558\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n                  </operand>\n               </then>\n            </caseItem>\n            <else localId=\"586\" xsi:type=\"Concatenate\">\n               <operand localId=\"583\" xsi:type=\"Concatenate\">\n                  <operand localId=\"581\" xsi:type=\"Concatenate\">\n                     <operand localId=\"578\" xsi:type=\"Concatenate\">\n                        <operand localId=\"576\" xsi:type=\"Concatenate\">\n                           <operand localId=\"573\" xsi:type=\"Concatenate\">\n                              <operand localId=\"571\" xsi:type=\"Concatenate\">\n                                 <operand localId=\"568\" xsi:type=\"Concatenate\">\n                                    <operand localId=\"566\" xsi:type=\"Concatenate\">\n                                       <operand localId=\"564\" xsi:type=\"Concatenate\">\n                                          <operand localId=\"562\" name=\"ingredientName\" xsi:type=\"OperandRef\"/>\n                                          <operand localId=\"563\" valueType=\"t:String\" value=\" \" xsi:type=\"Literal\"/>\n                                       </operand>\n                                       <operand localId=\"565\" name=\"doseFormName\" xsi:type=\"OperandRef\"/>\n                                    </operand>\n                                    <operand localId=\"567\" valueType=\"t:String\" value=\": \" xsi:type=\"Literal\"/>\n                                 </operand>\n                                 <operand localId=\"570\" xsi:type=\"ToString\">\n                                    <operand localId=\"569\" name=\"dosesPerDay\" xsi:type=\"OperandRef\"/>\n                                 </operand>\n                              </operand>\n                              <operand localId=\"572\" valueType=\"t:String\" value=\"/d * \" xsi:type=\"Literal\"/>\n                           </operand>\n                           <operand localId=\"575\" xsi:type=\"ToString\">\n                              <operand localId=\"574\" name=\"doseQuantity\" xsi:type=\"OperandRef\"/>\n                           </operand>\n                        </operand>\n                        <operand localId=\"577\" valueType=\"t:String\" value=\" * \" xsi:type=\"Literal\"/>\n                     </operand>\n                     <operand localId=\"580\" xsi:type=\"ToString\">\n                        <operand localId=\"579\" name=\"strength\" xsi:type=\"OperandRef\"/>\n                     </operand>\n                  </operand>\n                  <operand localId=\"582\" valueType=\"t:String\" value=\" = \" xsi:type=\"Literal\"/>\n               </operand>\n               <operand localId=\"585\" xsi:type=\"ToString\">\n                  <operand localId=\"584\" name=\"dailyDose\" xsi:type=\"OperandRef\"/>\n               </operand>\n            </else>\n         </expression>\n         <operand name=\"ingredientCode\">\n            <operandTypeSpecifier localId=\"498\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"ingredientName\">\n            <operandTypeSpecifier localId=\"499\" name=\"t:String\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"strength\">\n            <operandTypeSpecifier localId=\"500\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseFormCode\">\n            <operandTypeSpecifier localId=\"501\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseFormName\">\n            <operandTypeSpecifier localId=\"502\" name=\"t:String\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"doseQuantity\">\n            <operandTypeSpecifier localId=\"503\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"dosesPerDay\">\n            <operandTypeSpecifier localId=\"504\" name=\"t:Decimal\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n         <operand name=\"dailyDose\">\n            <operandTypeSpecifier localId=\"505\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n         </operand>\n      </def>\n      <def localId=\"672\" name=\"CalculateMMEs\" context=\"Patient\" accessLevel=\"Public\" xsi:type=\"FunctionDef\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"672\">\n               <a:s>define function CalculateMMEs(medications </a:s>\n               <a:s r=\"596\">\n                  <a:s>List&lt;</a:s>\n                  <a:s r=\"595\">\n                     <a:s>Tuple { </a:s>\n                     <a:s r=\"590\">\n                        <a:s>rxNormCode </a:s>\n                        <a:s r=\"589\">\n                           <a:s>Code</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>, </a:s>\n                     <a:s r=\"592\">\n                        <a:s>doseQuantity </a:s>\n                        <a:s r=\"591\">\n                           <a:s>Quantity</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>, </a:s>\n                     <a:s r=\"594\">\n                        <a:s>dosesPerDay </a:s>\n                        <a:s r=\"593\">\n                           <a:s>Decimal</a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s> }</a:s>\n                  </a:s>\n                  <a:s>></a:s>\n               </a:s>\n               <a:s>):\n  </a:s>\n               <a:s r=\"671\">\n                  <a:s r=\"671\">\n                     <a:s>Flatten(\n    </a:s>\n                     <a:s r=\"670\">\n                        <a:s>\n                           <a:s r=\"598\">\n                              <a:s r=\"597\">\n                                 <a:s>\n                                    <a:s>medications</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> M</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>\n      </a:s>\n                        <a:s>\n                           <a:s>let </a:s>\n                           <a:s r=\"602\">\n                              <a:s>Ingredients: </a:s>\n                              <a:s r=\"601\">\n                                 <a:s>GetIngredients(</a:s>\n                                 <a:s r=\"600\">\n                                    <a:s r=\"599\">\n                                       <a:s>M</a:s>\n                                    </a:s>\n                                    <a:s>.</a:s>\n                                    <a:s r=\"600\">\n                                       <a:s>rxNormCode</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>)</a:s>\n                              </a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>\n      </a:s>\n                        <a:s r=\"669\">\n                           <a:s>return\n        </a:s>\n                           <a:s r=\"668\">\n                              <a:s>\n                                 <a:s r=\"604\">\n                                    <a:s r=\"603\">\n                                       <a:s>\n                                          <a:s>Ingredients</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s> I</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>\n          </a:s>\n                              <a:s>\n                                 <a:s>let\n            </a:s>\n                                 <a:s r=\"608\">\n                                    <a:s>adjustedDoseQuantity: </a:s>\n                                    <a:s r=\"607\">\n                                       <a:s>EnsureMicrogramQuantity(</a:s>\n                                       <a:s r=\"606\">\n                                          <a:s r=\"605\">\n                                             <a:s>M</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"606\">\n                                             <a:s>doseQuantity</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>,\n            </a:s>\n                                 <a:s r=\"619\">\n                                    <a:s>dailyDose: </a:s>\n                                    <a:s r=\"618\">\n                                       <a:s>GetDailyDose(</a:s>\n                                       <a:s r=\"610\">\n                                          <a:s r=\"609\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"610\">\n                                             <a:s>ingredientCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"612\">\n                                          <a:s r=\"611\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"612\">\n                                             <a:s>strength</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"614\">\n                                          <a:s r=\"613\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"614\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"615\">\n                                          <a:s>adjustedDoseQuantity</a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"617\">\n                                          <a:s r=\"616\">\n                                             <a:s>M</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"617\">\n                                             <a:s>dosesPerDay</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                 </a:s>\n                                 <a:s>,\n            </a:s>\n                                 <a:s r=\"626\">\n                                    <a:s>factor: </a:s>\n                                    <a:s r=\"625\">\n                                       <a:s>GetConversionFactor(</a:s>\n                                       <a:s r=\"621\">\n                                          <a:s r=\"620\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"621\">\n                                             <a:s>ingredientCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"622\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                       <a:s>, </a:s>\n                                       <a:s r=\"624\">\n                                          <a:s r=\"623\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"624\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                       <a:s>)</a:s>\n                                    </a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s>\n          </a:s>\n                              <a:s r=\"667\">\n                                 <a:s>return </a:s>\n                                 <a:s r=\"666\">\n                                    <a:s>{\n            </a:s>\n                                    <a:s>\n                                       <a:s>rxNormCode: </a:s>\n                                       <a:s r=\"628\">\n                                          <a:s r=\"627\">\n                                             <a:s>M</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"628\">\n                                             <a:s>rxNormCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>doseFormCode: </a:s>\n                                       <a:s r=\"630\">\n                                          <a:s r=\"629\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"630\">\n                                             <a:s>doseFormCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>doseQuantity: </a:s>\n                                       <a:s r=\"631\">\n                                          <a:s>adjustedDoseQuantity</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>dosesPerDay: </a:s>\n                                       <a:s r=\"633\">\n                                          <a:s r=\"632\">\n                                             <a:s>M</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"633\">\n                                             <a:s>dosesPerDay</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>ingredientCode: </a:s>\n                                       <a:s r=\"635\">\n                                          <a:s r=\"634\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"635\">\n                                             <a:s>ingredientCode</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>ingredientName: </a:s>\n                                       <a:s r=\"637\">\n                                          <a:s r=\"636\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"637\">\n                                             <a:s>ingredientName</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>strength: </a:s>\n                                       <a:s r=\"639\">\n                                          <a:s r=\"638\">\n                                             <a:s>I</a:s>\n                                          </a:s>\n                                          <a:s>.</a:s>\n                                          <a:s r=\"639\">\n                                             <a:s>strength</a:s>\n                                          </a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>dailyDose: </a:s>\n                                       <a:s r=\"640\">\n                                          <a:s>dailyDose</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>dailyDoseDescription: </a:s>\n                                       <a:s r=\"655\">\n                                          <a:s>GetDailyDoseDescription(</a:s>\n                                          <a:s r=\"642\">\n                                             <a:s r=\"641\">\n                                                <a:s>I</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"642\">\n                                                <a:s>ingredientCode</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"644\">\n                                             <a:s r=\"643\">\n                                                <a:s>I</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"644\">\n                                                <a:s>ingredientName</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"646\">\n                                             <a:s r=\"645\">\n                                                <a:s>I</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"646\">\n                                                <a:s>strength</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"648\">\n                                             <a:s r=\"647\">\n                                                <a:s>I</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"648\">\n                                                <a:s>doseFormCode</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"650\">\n                                             <a:s r=\"649\">\n                                                <a:s>I</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"650\">\n                                                <a:s>doseFormName</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"651\">\n                                             <a:s>adjustedDoseQuantity</a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"653\">\n                                             <a:s r=\"652\">\n                                                <a:s>M</a:s>\n                                             </a:s>\n                                             <a:s>.</a:s>\n                                             <a:s r=\"653\">\n                                                <a:s>dosesPerDay</a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>, </a:s>\n                                          <a:s r=\"654\">\n                                             <a:s>dailyDose</a:s>\n                                          </a:s>\n                                          <a:s>)</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>conversionFactor: </a:s>\n                                       <a:s r=\"656\">\n                                          <a:s>factor</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>,\n            </a:s>\n                                    <a:s>\n                                       <a:s>mme: </a:s>\n                                       <a:s r=\"665\">\n                                          <a:s>Quantity {\n              </a:s>\n                                          <a:s>\n                                             <a:s>value: </a:s>\n                                             <a:s r=\"660\">\n                                                <a:s r=\"658\">\n                                                   <a:s r=\"657\">\n                                                      <a:s>dailyDose</a:s>\n                                                   </a:s>\n                                                   <a:s>.</a:s>\n                                                   <a:s r=\"658\">\n                                                      <a:s>value</a:s>\n                                                   </a:s>\n                                                </a:s>\n                                                <a:s> * </a:s>\n                                                <a:s r=\"659\">\n                                                   <a:s>factor</a:s>\n                                                </a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>,\n              </a:s>\n                                          <a:s>\n                                             <a:s>unit: </a:s>\n                                             <a:s r=\"664\">\n                                                <a:s r=\"662\">\n                                                   <a:s r=\"661\">\n                                                      <a:s>dailyDose</a:s>\n                                                   </a:s>\n                                                   <a:s>.</a:s>\n                                                   <a:s r=\"662\">\n                                                      <a:s>unit</a:s>\n                                                   </a:s>\n                                                </a:s>\n                                                <a:s> + </a:s>\n                                                <a:s r=\"663\">\n                                                   <a:s>\'/d\'</a:s>\n                                                </a:s>\n                                             </a:s>\n                                          </a:s>\n                                          <a:s>\n            }</a:s>\n                                       </a:s>\n                                    </a:s>\n                                    <a:s>\n          }</a:s>\n                                 </a:s>\n                              </a:s>\n                           </a:s>\n                        </a:s>\n                     </a:s>\n                     <a:s>\n  )</a:s>\n                  </a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"671\" xsi:type=\"Flatten\">\n            <operand localId=\"670\" xsi:type=\"Query\">\n               <source localId=\"598\" alias=\"M\">\n                  <expression localId=\"597\" name=\"medications\" xsi:type=\"OperandRef\"/>\n               </source>\n               <let localId=\"602\" identifier=\"Ingredients\">\n                  <expression localId=\"601\" name=\"GetIngredients\" xsi:type=\"FunctionRef\">\n                     <operand localId=\"600\" path=\"rxNormCode\" scope=\"M\" xsi:type=\"Property\"/>\n                  </expression>\n               </let>\n               <return localId=\"669\">\n                  <expression localId=\"668\" xsi:type=\"Query\">\n                     <source localId=\"604\" alias=\"I\">\n                        <expression localId=\"603\" name=\"Ingredients\" xsi:type=\"QueryLetRef\"/>\n                     </source>\n                     <let localId=\"608\" identifier=\"adjustedDoseQuantity\">\n                        <expression localId=\"607\" name=\"EnsureMicrogramQuantity\" xsi:type=\"FunctionRef\">\n                           <operand localId=\"606\" path=\"doseQuantity\" scope=\"M\" xsi:type=\"Property\"/>\n                        </expression>\n                     </let>\n                     <let localId=\"619\" identifier=\"dailyDose\">\n                        <expression localId=\"618\" name=\"GetDailyDose\" xsi:type=\"FunctionRef\">\n                           <operand localId=\"610\" path=\"ingredientCode\" scope=\"I\" xsi:type=\"Property\"/>\n                           <operand localId=\"612\" path=\"strength\" scope=\"I\" xsi:type=\"Property\"/>\n                           <operand localId=\"614\" path=\"doseFormCode\" scope=\"I\" xsi:type=\"Property\"/>\n                           <operand localId=\"615\" name=\"adjustedDoseQuantity\" xsi:type=\"QueryLetRef\"/>\n                           <operand localId=\"617\" path=\"dosesPerDay\" scope=\"M\" xsi:type=\"Property\"/>\n                        </expression>\n                     </let>\n                     <let localId=\"626\" identifier=\"factor\">\n                        <expression localId=\"625\" name=\"GetConversionFactor\" xsi:type=\"FunctionRef\">\n                           <operand localId=\"621\" path=\"ingredientCode\" scope=\"I\" xsi:type=\"Property\"/>\n                           <operand localId=\"622\" name=\"dailyDose\" xsi:type=\"QueryLetRef\"/>\n                           <operand localId=\"624\" path=\"doseFormCode\" scope=\"I\" xsi:type=\"Property\"/>\n                        </expression>\n                     </let>\n                     <return localId=\"667\">\n                        <expression localId=\"666\" xsi:type=\"Tuple\">\n                           <element name=\"rxNormCode\">\n                              <value localId=\"628\" path=\"rxNormCode\" scope=\"M\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"doseFormCode\">\n                              <value localId=\"630\" path=\"doseFormCode\" scope=\"I\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"doseQuantity\">\n                              <value localId=\"631\" name=\"adjustedDoseQuantity\" xsi:type=\"QueryLetRef\"/>\n                           </element>\n                           <element name=\"dosesPerDay\">\n                              <value localId=\"633\" path=\"dosesPerDay\" scope=\"M\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"ingredientCode\">\n                              <value localId=\"635\" path=\"ingredientCode\" scope=\"I\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"ingredientName\">\n                              <value localId=\"637\" path=\"ingredientName\" scope=\"I\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"strength\">\n                              <value localId=\"639\" path=\"strength\" scope=\"I\" xsi:type=\"Property\"/>\n                           </element>\n                           <element name=\"dailyDose\">\n                              <value localId=\"640\" name=\"dailyDose\" xsi:type=\"QueryLetRef\"/>\n                           </element>\n                           <element name=\"dailyDoseDescription\">\n                              <value localId=\"655\" name=\"GetDailyDoseDescription\" xsi:type=\"FunctionRef\">\n                                 <operand localId=\"642\" path=\"ingredientCode\" scope=\"I\" xsi:type=\"Property\"/>\n                                 <operand localId=\"644\" path=\"ingredientName\" scope=\"I\" xsi:type=\"Property\"/>\n                                 <operand localId=\"646\" path=\"strength\" scope=\"I\" xsi:type=\"Property\"/>\n                                 <operand localId=\"648\" path=\"doseFormCode\" scope=\"I\" xsi:type=\"Property\"/>\n                                 <operand localId=\"650\" path=\"doseFormName\" scope=\"I\" xsi:type=\"Property\"/>\n                                 <operand localId=\"651\" name=\"adjustedDoseQuantity\" xsi:type=\"QueryLetRef\"/>\n                                 <operand localId=\"653\" path=\"dosesPerDay\" scope=\"M\" xsi:type=\"Property\"/>\n                                 <operand localId=\"654\" name=\"dailyDose\" xsi:type=\"QueryLetRef\"/>\n                              </value>\n                           </element>\n                           <element name=\"conversionFactor\">\n                              <value localId=\"656\" name=\"factor\" xsi:type=\"QueryLetRef\"/>\n                           </element>\n                           <element name=\"mme\">\n                              <value localId=\"665\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                                 <element name=\"value\">\n                                    <value localId=\"660\" xsi:type=\"Multiply\">\n                                       <operand localId=\"658\" path=\"value\" xsi:type=\"Property\">\n                                          <source localId=\"657\" name=\"dailyDose\" xsi:type=\"QueryLetRef\"/>\n                                       </operand>\n                                       <operand localId=\"659\" name=\"factor\" xsi:type=\"QueryLetRef\"/>\n                                    </value>\n                                 </element>\n                                 <element name=\"unit\">\n                                    <value localId=\"664\" xsi:type=\"Concatenate\">\n                                       <operand localId=\"662\" path=\"unit\" xsi:type=\"Property\">\n                                          <source localId=\"661\" name=\"dailyDose\" xsi:type=\"QueryLetRef\"/>\n                                       </operand>\n                                       <operand localId=\"663\" valueType=\"t:String\" value=\"/d\" xsi:type=\"Literal\"/>\n                                    </value>\n                                 </element>\n                              </value>\n                           </element>\n                        </expression>\n                     </return>\n                  </expression>\n               </return>\n            </operand>\n         </expression>\n         <operand name=\"medications\">\n            <operandTypeSpecifier localId=\"596\" xsi:type=\"ListTypeSpecifier\">\n               <elementType localId=\"595\" xsi:type=\"TupleTypeSpecifier\">\n                  <element localId=\"590\" name=\"rxNormCode\">\n                     <type localId=\"589\" name=\"t:Code\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </element>\n                  <element localId=\"592\" name=\"doseQuantity\">\n                     <type localId=\"591\" name=\"t:Quantity\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </element>\n                  <element localId=\"594\" name=\"dosesPerDay\">\n                     <type localId=\"593\" name=\"t:Decimal\" xsi:type=\"NamedTypeSpecifier\"/>\n                  </element>\n               </elementType>\n            </operandTypeSpecifier>\n         </operand>\n      </def>\n      <def localId=\"682\" name=\"TestCalculateMMEs\" context=\"Patient\" accessLevel=\"Public\">\n         <annotation xsi:type=\"a:Annotation\">\n            <a:s r=\"682\">\n               <a:s>define TestCalculateMMEs:\n  </a:s>\n               <a:s r=\"681\">\n                  <a:s>CalculateMMEs(</a:s>\n                  <a:s r=\"680\">\n                     <a:s>{ </a:s>\n                     <a:s r=\"679\">\n                        <a:s>{ </a:s>\n                        <a:s>\n                           <a:s>rxNormCode: </a:s>\n                           <a:s r=\"674\">\n                              <a:s>Code \'388508\' from </a:s>\n                              <a:s r=\"673\">\n                                 <a:s>RxNorm</a:s>\n                              </a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>, </a:s>\n                        <a:s>\n                           <a:s>doseQuantity: </a:s>\n                           <a:s r=\"677\">\n                              <a:s>Quantity { </a:s>\n                              <a:s>\n                                 <a:s>value: 1</a:s>\n                              </a:s>\n                              <a:s>, </a:s>\n                              <a:s>\n                                 <a:s>unit: </a:s>\n                                 <a:s r=\"676\">\n                                    <a:s>\'patch\'</a:s>\n                                 </a:s>\n                              </a:s>\n                              <a:s> }</a:s>\n                           </a:s>\n                        </a:s>\n                        <a:s>, </a:s>\n                        <a:s>\n                           <a:s>dosesPerDay: 0.33</a:s>\n                        </a:s>\n                        <a:s> }</a:s>\n                     </a:s>\n                     <a:s> }</a:s>\n                  </a:s>\n                  <a:s>)</a:s>\n               </a:s>\n            </a:s>\n         </annotation>\n         <expression localId=\"681\" name=\"CalculateMMEs\" xsi:type=\"FunctionRef\">\n            <operand localId=\"680\" xsi:type=\"List\">\n               <element localId=\"679\" xsi:type=\"Tuple\">\n                  <element name=\"rxNormCode\">\n                     <value localId=\"674\" code=\"388508\" xsi:type=\"Code\">\n                        <system localId=\"673\" name=\"RxNorm\"/>\n                     </value>\n                  </element>\n                  <element name=\"doseQuantity\">\n                     <value localId=\"677\" classType=\"t:Quantity\" xsi:type=\"Instance\">\n                        <element name=\"value\">\n                           <value xsi:type=\"ToDecimal\">\n                              <operand localId=\"675\" valueType=\"t:Integer\" value=\"1\" xsi:type=\"Literal\"/>\n                           </value>\n                        </element>\n                        <element name=\"unit\">\n                           <value localId=\"676\" valueType=\"t:String\" value=\"patch\" xsi:type=\"Literal\"/>\n                        </element>\n                     </value>\n                  </element>\n                  <element name=\"dosesPerDay\">\n                     <value localId=\"678\" valueType=\"t:Decimal\" value=\"0.33\" xsi:type=\"Literal\"/>\n                  </element>\n               </element>\n            </operand>\n         </expression>\n      </def>\n   </statements>\n</library>\n"
  }
  url {
    value: "elm/OMTKLogic-0.1.0.xml"
  }
}
